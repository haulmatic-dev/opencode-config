{
  "$schema": "https://opencode.ai/config.json",
  "instructions": ["/Users/buddhi/.config/opencode/AGENTS.md"],
  "permission": {
    "edit": "allow",
    "bash": "allow",
    "write": "allow"
  },
  "command": {
    "opencode-init": {
      "description": "Initialize opencode - Check tools, PM2, services, install missing, start services, initialize workspace",
      "template": "You are an opencode initialization assistant. Use the `question` tool to present options to the user for interactive selection.\n\n## Step 1: Check System Tools\n\nRun these commands to get the system tools status:\n\n```\ncommand -v cm && echo \"cm: INSTALLED\" || echo \"cm: MISSING\"\ncommand -v bd && echo \"bd: INSTALLED\" || echo \"bd: MISSING\"\ncommand -v bv && echo \"bv: INSTALLED\" || echo \"bv: MISSING\"\ncommand -v tldr && echo \"tldr: INSTALLED\" || echo \"tldr: MISSING\"\ncommand -v biome && echo \"biome: INSTALLED\" || echo \"biome: MISSING\"\ncommand -v prettier && echo \"prettier: INSTALLED\" || echo \"prettier: MISSING\"\ncommand -v ubs && echo \"ubs: INSTALLED\" || echo \"ubs: MISSING\"\ncommand -v pm2 && echo \"pm2: INSTALLED\" || echo \"pm2: MISSING\"\ncommand -v opencode-init && echo \"opencode-init: IN_PATH\" || echo \"opencode-init: NOT_IN_PATH\"\n```\n\n## Step 2: Check PM2 Status\n\nRun these commands to check PM2:\n\n```\n# Check if PM2 is installed\ncommand -v pm2 && echo \"pm2: INSTALLED\" || echo \"pm2: MISSING\"\n\n# Check PM2 version\ncommand -v pm2 && pm2 --version\n\n# Check PM2 processes\ncommand -v pm2 && pm2 list 2>/dev/null || echo \"pm2_list: ERROR\"\n\n# Check PM2 startup script\ncommand -v pm2 && pm2 startup 2>/dev/null | head -5 || echo \"pm2_startup: NOT_CONFIGURED\"\n\n# Check PM2 save\ncommand -v pm2 && pm2 save 2>/dev/null && echo \"pm2_save: CONFIGURED\" || echo \"pm2_save: NOT_CONFIGURED\"\n```\n\n## Step 3: Check Running Services\n\nRun these commands to get the services status:\n\n```\n# Check TLDR daemon\nTLDR_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" http://localhost:3000/health 2>/dev/null || echo \"000\")\n[ \"$TLDR_STATUS\" = \"200\" ] && echo \"tldr: RUNNING\" || echo \"tldr: STOPPED\"\n\n# Check GPTCache\nGPTCACHE_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" http://localhost:8000/cache_status 2>/dev/null || echo \"000\")\n[ \"$GPTCACHE_STATUS\" = \"200\" ] && echo \"gptcache: RUNNING\" || echo \"gptcache: STOPPED\"\n\n# Check cass_memory\npgrep -f \"cass_memory\" > /dev/null 2>&1 && echo \"cass_memory: RUNNING\" || echo \"cass_memory: STOPPED\"\n\n# Check PM2-managed processes\ncommand -v pm2 && pm2 jlist 2>/dev/null | grep -q \"name\" && echo \"pm2_procs: ACTIVE\" || echo \"pm2_procs: NONE\"\n```\n\n## Step 4: Check Workspace Initialization\n\nRun these commands to get the workspace status:\n\n```\n[ -d \".git\" ] && echo \"git: INITIALIZED\" || echo \"git: NOT_INITIALIZED\"\n[ -d \".beads\" ] && echo \"beads: INITIALIZED\" || echo \"beads: NOT_INITIALIZED\"\n[ -d \".cass\" ] && echo \"cass_workspace: INITIALIZED\" || echo \"cass_workspace: NOT_INITIALIZED\"\n[ -d \".tldr\" ] && echo \"tldr_index: CREATED\" || echo \"tldr_index: NOT_CREATED\"\n[ -f \"biome.json\" ] && echo \"biome: PRESENT\" || echo \"biome: MISSING\"\n[ -f \".prettierrc\" ] && echo \"prettier: PRESENT\" || echo \"prettier: MISSING\"\n[ -f \"opencode.json\" ] && echo \"opencode_json: PRESENT\" || echo \"opencode_json: MISSING\"\n[ -f \".git/hooks/pre-commit\" ] && echo \"git_hooks: INSTALLED\" || echo \"git_hooks: NOT_INSTALLED\"\n[ -f \"ecosystem.config.js\" ] && echo \"pm2_ecosystem: PRESENT\" || echo \"pm2_ecosystem: MISSING\"\n```\n\n## Step 5: Present Status Report\n\nCreate a clear status report with emoji:\n\n### üõ†Ô∏è System Tools\n| Tool | Status |\n|------|--------|\n| cm (cass_memory) | INSTALLED/MISSING |\n| bd (Beads CLI) | INSTALLED/MISSING |\n| bv (Beads Viewer) | INSTALLED/MISSING |\n| TLDR | INSTALLED/MISSING |\n| Biome | INSTALLED/MISSING |\n| Prettier | INSTALLED/MISSING |\n| UBS | INSTALLED/MISSING |\n| **PM2** | **INSTALLED/MISSING** |\n\n### üîÑ PM2 Status\n| Check | Status |\n|-------|--------|\n| PM2 installed | YES/NO |\n| Startup script | CONFIGURED/NOT_CONFIGURED |\n| Save configured | YES/NO |\n| Active processes | COUNT/NONE |\n\n### üîÑ Services\n| Service | Status | Port | PM2 Managed |\n|---------|--------|------|-------------|\n| TLDR daemon | RUNNING/STOPPED | 3000 | YES/NO |\n| GPTCache | RUNNING/STOPPED | 8000 | YES/NO |\n| cass_memory | RUNNING/STOPPED | - | YES/NO |\n\n### üìÅ Workspace\n| Component | Status |\n|-----------|--------|\n| Git | INITIALIZED/NOT_INITIALIZED |\n| Beads | INITIALIZED/NOT_INITIALIZED |\n| cass_memory | INITIALIZED/NOT_INITIALIZED |\n| TLDR index | CREATED/NOT_CREATED |\n| biome.json | PRESENT/MISSING |\n| .prettierrc | PRESENT/MISSING |\n| opencode.json | PRESENT/MISSING |\n| Git hooks | INSTALLED/NOT_INSTALLED |\n| PM2 ecosystem | PRESENT/MISSING |\n\n## Step 6: Use question Tool for Interactive Selection\n\nUse the `question` tool to present options:\n\n```javascript\nawait question({\n  questions: [\n    {\n      header: \"OpenCode Setup\",\n      question: \"What would you like to do? Select an option:\",\n      options: [\n        {\n          label: \"Install Tools + PM2\",\n          description: \"Install missing system tools and PM2 process manager\"\n        },\n        {\n          label: \"Setup PM2\",\n          description: \"Configure PM2, create ecosystem file, enable startup\"\n        },\n        {\n          label: \"Start Services\",\n          description: \"Start TLDR, GPTCache, and cass_memory via PM2\"\n        },\n        {\n          label: \"Init Workspace\",\n          description: \"Initialize this project workspace\"\n        },\n        {\n          label: \"Do All\",\n          description: \"Install tools, setup PM2, start services, init workspace\"\n        },\n        {\n          label: \"Skip\",\n          description: \"Don't do anything\"\n        }\n      ]\n    }\n  ]\n})\n```\n\n## Step 7: Execute Based on Selection\n\nBased on the user's selection, execute the appropriate commands:\n\n### If \"Install Tools + PM2\" or \"Do All\":\nRun: `~/.config/opencode/bin/opencode-init --quiet`\n\nThen install PM2 globally:\n```bash\nnpm install -g pm2\n```\n\n### If \"Setup PM2\" or \"Do All\":\n```bash\n# Install PM2 if not installed\ncommand -v pm2 || npm install -g pm2\n\n# Create ecosystem.config.js for opencode services\ncat > ecosystem.config.js << 'EOF'\nmodule.exports = {\n  apps: [\n    {\n      name: 'tldr',\n      script: 'tldr',\n      args: 'daemon start',\n      cwd: '/Users/buddhi/.config/opencode',\n      interpreter: 'none',\n      watch: false,\n      autorestart: true,\n      max_restarts: 10,\n      min_uptime: 5000,\n      exp_backoff_restart_delay: 100,\n    },\n    {\n      name: 'gptcache',\n      script: 'gptcache-server',\n      cwd: '/Users/buddhi/.config/opencode',\n      watch: false,\n      autorestart: true,\n      max_restarts: 10,\n      min_uptime: 5000,\n    },\n    {\n      name: 'cass_memory',\n      script: 'cass',\n      args: 'serve',\n      cwd: '/Users/buddhi/.config/opencode',\n      interpreter: 'none',\n      watch: false,\n      autorestart: true,\n      max_restarts: 10,\n      min_uptime: 5000,\n    }\n  ]\n};\nEOF\n\n# Setup PM2 startup\nsudo pm2 startup\n\n# Start all services via PM2\npm2 start ecosystem.config.js\n\n# Save current process list\npm2 save\n\n# Show status\npm2 list\n```\n\n### If \"Start Services\" or \"Do All\":\n```bash\n# Check if PM2 is installed\nif ! command -v pm2 &> /dev/null; then\n    npm install -g pm2\nfi\n\n# Check if ecosystem file exists\nif [ -f \"ecosystem.config.js\" ]; then\n    pm2 start ecosystem.config.js\n    pm2 save\nelse\n    # Start services individually\n    command -v tldr && tldr daemon start 2>/dev/null\n    command -v gptcache-server && gptcache-server &\n    command -v cass_memory && cass_memory --daemon & 2>/dev/null || cass_memory serve & 2>/dev/null\nfi\n\n# Show status\npm2 list\n```\n\n### If \"Init Workspace\" or \"Do All\":\nRun: `~/.config/opencode/bin/workspace-init --force`\n\n## Step 8: Report Results\n\nAfter execution, provide a clear summary:\n\n### ‚úÖ Completed Actions\n- List all tools installed\n- PM2 installation status\n- PM2 ecosystem file created\n- Services started via PM2\n- PM2 startup configured\n- All workspace components initialized\n\n### üîÑ PM2 Specific Results\n| Action | Status |\n|--------|--------|\n| PM2 installed | YES/NO |\n| Ecosystem file | CREATED/UPDATED |\n| Services started | COUNT |\n| Startup configured | YES/NO |\n| Save configured | YES/NO |\n\n### ‚ùå Errors\n- Report any errors that occurred\n- Suggest fixes if possible\n\n### üí° Next Steps\n- Suggest useful commands:\n  - `pm2 list` - View all processes\n  - `pm2 logs` - View logs\n  - `pm2 monit` - Monitor in real-time\n  - `pm2 restart all` - Restart all services\n  - `pm2 save` - Save process list\n  - `bd ready` - See available tasks\n  - `cm context \"your task\"` - Get context\n\n## Important Notes\n\n- Always use the `question` tool for user selection\n- PM2 is critical for keeping services running persistently\n- PM2 ecosystem file should be committed to git\n- PM2 startup script survives reboots\n- Use `pm2 save` after any process changes\n- Services to manage with PM2:\n  - TLDR daemon (tldr daemon start)\n  - GPTCache (gptcache-server)\n  - cass_memory (cass serve / cass_memory --daemon)\n- Use emoji (‚úÖ ‚ùå ‚ö†Ô∏è üîÑ üõ†Ô∏è üìÅ üîÑ) for visual clarity",
      "agent": "build"
    }
  },
  "provider": {
    "glm-47": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Z.AI",
      "options": {
        "baseURL": "https://api.z.ai/api/coding/paas/v4"
      },
      "models": {
        "glm-4.7": {
          "name": "GLM 4.7 BYOM",
          "limit": {
            "context": 200000,
            "output": 8192
          }
        }
      }
    },
    "glm-46": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Z.AI",
      "options": {
        "baseURL": "https://api.z.ai/api/coding/paas/v4"
      },
      "models": {
        "glm-4.6": {
          "name": "GLM 4.6 BYOM",
          "limit": {
            "context": 200000,
            "output": 8192
          }
        }
      }
    },
    "gemini-2-5-pro": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Google AI",
      "options": {
        "baseURL": "https://generativelanguage.googleapis.com/v1beta/"
      },
      "models": {
        "gemini-2.5-pro": {
          "name": "Gemini 2.5 Pro [Google]",
          "limit": {
            "context": 1000000,
            "output": 65536
          }
        }
      }
    },
    "gemini-3-pro": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Google AI",
      "options": {
        "baseURL": "https://generativelanguage.googleapis.com/v1beta/"
      },
      "models": {
        "gemini-3.0-pro": {
          "name": "Gemini 3.0 Pro [Google]",
          "limit": {
            "context": 1000000,
            "output": 65536
          }
        }
      }
    },
    "kimi-thinking-moonshot": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Moonshot AI",
      "options": {
        "baseURL": "https://api.moonshot.ai/v1"
      },
      "models": {
        "kimi-k2-thinking": {
          "name": "Kimi K2 Thinking (MoonshotAI)",
          "limit": {
            "context": 256000,
            "output": 32768
          }
        }
      }
    },
    "kimi-thinking-fireworks": {
      "npm": "@ai-sdk/openai-compatible",
      "name": "Fireworks AI",
      "options": {
        "baseURL": "https://api.fireworks.ai/inference/v1"
      },
      "models": {
        "accounts/fireworks/models/kimi-k2-thinking": {
          "name": "Kimi K2 Thinking [Fireworks]",
          "limit": {
            "context": 256000,
            "output": 16384
          }
        }
      }
    }
  },
  "plugin": [
    "./plugin/gptcache.mjs",
    "./plugin/cass.mjs",
    "./plugin/beads.mjs",
    "./plugin/beads-tools.mjs",
    "./plugin/setup.mjs",
    "./plugin/init-commands.mjs",
    "./plugin/tldr.mjs"
  ]
}
