{"id":"opencode-07i","title":"Migrate test suite from Factory CLI to opencode tests/","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:07:42.172098+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:51.680366+05:30","closed_at":"2026-01-06T14:10:51.680366+05:30","close_reason":"Completed: Tests migrated"}
{"id":"opencode-0bc","title":"Migrate Factory CLI to opencode with cass_memory","description":"Complete migration of Factory CLI framework to opencode with cass_memory as primary learning system. Includes: Hook-based service checks, MCP Agent Mail, Beads CLI, Beads Viewer (bv), Factory CLS migration to cass_memory rules, droids, skills, test suite, and documentation updates.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T11:55:50.677898+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:55.052285+05:30","closed_at":"2026-01-06T14:10:55.052285+05:30","close_reason":"Completed: All Factory CLI components migrated to opencode - droids, skills, tests, docs, MCP integration"}
{"id":"opencode-0zl","title":"Integrate MCP Agent Mail into opencode-init","description":"Add MCP Agent Mail installation step to ~/.config/opencode/bin/opencode-init. Check Python 3.10+, clone repository if missing, create .env, run uv sync. This is REQUIRED and will fail if installation fails.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.384046+05:30","created_by":"buddhi","updated_at":"2026-01-06T23:49:09.456094+05:30","closed_at":"2026-01-06T23:49:09.456094+05:30","close_reason":"Added MCP Agent Mail installation (Step 7) to opencode-init. Checks Python 3.14+, clones repository, creates .env, runs uv sync, starts server. This is REQUIRED for opencode headless mode."}
{"id":"opencode-3mg","title":"Migrate documentation from Factory CLI to opencode docs/","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:07:42.157923+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:51.644504+05:30","closed_at":"2026-01-06T14:10:51.644504+05:30","close_reason":"Completed: Documentation migrated"}
{"id":"opencode-44n","title":"Implement new specialist agents (test-specialist, code-reviewer, deployment-specialist)","description":"Create 3 new specialist agents for automated test generation, code review, and deployment automation","design":"## New Specialist Agents to Implement\n\n### 1. test-specialist Agent\n**Purpose:** Generate test specifications and test code for acceptance criteria\n\n**Capabilities:**\n- Generate comprehensive test specifications (unit, integration, E2E)\n- Write test code (pytest, jest, playwright, cypress)\n- Create test fixtures and mocks\n- Ensure test coverage ≥ 80%\n- Optimize test performance\n\n**Input:**\n- Feature requirements\n- Figma designs (if applicable)\n- Acceptance criteria\n- Existing codebase\n\n**Output:**\n- `test-specification.md` - Detailed test plan\n- `tests/unit/*.test.js` - Unit test files\n- `tests/integration/*.test.js` - Integration test files\n- `tests/e2e/*.test.js` - E2E test files (Playwright/Cypress)\n- `tests/fixtures/*.js` - Test fixtures\n- `tests/mocks/*.js` - Test mocks\n- `package.json` - Updated with test scripts\n\n**Stage:** Stage 1 (Test Specification \u0026 Generation)\n\n### 2. code-reviewer Agent\n**Purpose:** Comprehensive code review with automated checks\n\n**Capabilities:**\n- Parse review comments from PRs\n- Classify comments by type (bug, style, architecture, performance, security, documentation, accessibility)\n- Create tasks for each comment category\n- Enforce automated review checks (PR size, TODO/FIXME, debug statements, documentation)\n- Assess performance implications\n- Verify security implications\n- Check accessibility compliance\n\n**Input:**\n- PR diff\n- Review comments (from GitHub/GitLab API)\n- Code quality reports\n\n**Output:**\n- `code-review-report.json` - Automated review results\n- `performance-assessment.json` - Performance impact analysis\n- `security-assessment.json` - Security implications\n- `accessibility-report.json` - A11y compliance\n- `documentation-checklist.json` - Documentation verification\n- Beads tasks for review comments (if any)\n\n**Stage:** Stage 5 (Code Review \u0026 Validation)\n\n**Task Creation Patterns:**\n- security → \"Fix Security Issues\" (P0)\n- bug → \"Fix Review Bugs\" (P0)\n- architecture → \"Refactor Architecture Issues\" (P1)\n- performance → \"Optimize Performance Issues\" (P1)\n- accessibility → \"Fix Accessibility Issues\" (P1)\n- documentation → \"Add Missing Documentation\" (P2)\n- style → \"Address Style Comments\" (P3)\n\n### 3. deployment-specialist Agent\n**Purpose:** Deployment automation and monitoring\n\n**Capabilities:**\n- Deploy to staging/production\n- Run smoke tests\n- Check health endpoints\n- Configure monitoring and logging\n- Set up error tracking (Sentry)\n- Create rollback plans\n- Monitor for deployment failures\n\n**Input:**\n- CI/CD pipeline status\n- Deployment configuration\n- Health check endpoints\n\n**Output:**\n- `deployment-report.json` - Deployment results\n- `health-check-report.json` - Service health status\n- `monitoring-config.json` - Monitoring configuration\n- `rollback-plan.md` - Rollback procedures\n- Beads tasks for deployment failures (if any)\n\n**Stage:** Stage 6 (Deployment \u0026 Monitoring)\n\n**Failure Handling:**\n- P0 \"Rollback failed deployment\" (immediate)\n- P0 \"Investigate deployment failure\" (after rollback)\n- P0 \"Fix failing smoke tests\"\n- P0 \"Fix service health issues\"\n\n## Existing Agents (Already Installed)\n\n### Primary Agents (Tab Completion)\n1. **orchestrator** - Master coordinator with dual-mode operation (COORDINATION vs DIRECT)\n2. **prd** - Product Requirements Document generator with stakeholder alignment\n3. **generate-tasks** - Atomic task breakdown with dependencies\n4. **task-coordinator** - Beads task creation and tracking\n\n### Internal Research Droids (9 agents)\n1. **codebase-researcher** - Pattern discovery and technical debt identification\n2. **git-history-analyzer** - Change evolution and team collaboration analysis\n3. **context-researcher** - Project-wide context gathering (stakeholder analysis)\n4. **best-practices-researcher** - Industry best practices and competitive analysis\n5. **library-source-reader** - Third-party library deep analysis\n6. **domain-specialist** - Domain-specific expertise and compliance\n7. **semantic-search** (osgrep) - Conceptual code search with embedding models\n8. **file-picker-agent** - Targeted file discovery and codebase navigation\n9. **figma-design-extractor** - Figma design token extraction for pixel-perfect implementation\n\n### Skills (3 skills)\n- **task-breakdown** - Feature → tasks workflow\n- **feature-planning** - End-to-end PRD generation\n- **complex-project** - Enterprise feature planning\n\n## Existing Tools \u0026 Infrastructure\n\n### Task Tracking (Beads)\n**Status:** ✅ Ready\n**Commands:**\n- `bd ready` - Find available work (unblocked)\n- `bd show \u003cid\u003e` - View issue details\n- `bd update \u003cid\u003e --status in_progress` - Claim work\n- `bd close \u003cid\u003e` - Complete work\n- `bd sync` - Commit and push changes\n- `bd create` - Create new task\n\n**Features:**\n- Dependency-aware task tracking\n- Graph analytics (PageRank, critical path, cycles)\n- Time-travel (compare project state across revisions)\n- Bead-to-commit correlations\n- Git-native persistence (.beads/ directory)\n\n### Agent Coordination (MCP Agent Mail)\n**Status:** ✅ Ready\n**Client:** `~/.config/opencode/mcp_agent_mail_client.py`\n\n**Available Functions:**\n- `reserve_file_paths(agent_name, paths, ttl_seconds)` - Reserve files before editing\n- `release_file_reservations(agent_name)` - Release files after completion\n\n**Features:**\n- HTTP API for agent communication\n- Message formats: task_assignment, task_completion, error_report, status_update\n- File reservations prevent conflicts\n- TTL-based auto-release (if worker crashes)\n- Agent registration tracking\n\n### Memory System (cass_memory)\n**Status:** ✅ Ready\n**Command:** `cm context \"\u003ctask\u003e\" --json`\n\n**Returns:**\n- `relevantBullets` - Evidence-backed rules\n- `antiPatterns` - Pitfalls to avoid\n- `historySnippets` - Similar past sessions\n- `suggestedCassQueries` - Deeper investigation searches\n\n**Features:**\n- Evidence validation (rules require historical proof)\n- Confidence decay (90-day half-life prevents stale patterns)\n- Anti-pattern learning (bad rules auto-convert to warnings)\n- Trauma guard (blocks dangerous commands)\n- Cross-agent learning\n\n### Process Management (PM2)\n**Status:** ❌ Not installed (needs npm install -g pm2)\n**Purpose:** Process lifecycle, restarts, scaling, resource limits\n\n### CI/CD Pipeline\n**Status:** ❌ Not implemented\n**Needs:** GitHub Actions workflow for stages 3-6\n\n### Testing Frameworks\n**Status:** ⚠️ Partial (17 test scripts exist but no runner)\n**Needs:** pytest/jest integration, coverage reporting\n\n### Code Quality Tools\n**Status:** ❌ Not implemented\n**Needs:** ESLint, Prettier, Black, pylint, Snyk\n\n### Monitoring \u0026 Logging\n**Status:** ❌ Not implemented\n**Needs:** Prometheus, Grafana, Sentry, PagerDuty, ELK Stack\n\n### Deployment Infrastructure\n**Status:** ❌ Not implemented\n**Needs:** Staging environment, deployment scripts, health check endpoints","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-08T12:20:33.817334+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:20:33.817334+05:30"}
{"id":"opencode-4wm","title":"Create opencode MCP Agent Mail client helper","description":"Create ~/.config/opencode/mcp_agent_mail_client.py - HTTP-based client for opencode agents to communicate with MCP Agent Mail. Adapted from Factory's mcp_agent_mail_client.py but using requests instead of MCP client. Functions: register_agent, send_message, fetch_inbox, acknowledge_message, reserve_file_paths, release_file_reservations.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.386134+05:30","created_by":"buddhi","updated_at":"2026-01-06T23:47:40.132488+05:30","closed_at":"2026-01-06T23:47:40.132488+05:30","close_reason":"Created ~/.config/opencode/mcp_agent_mail_client.py - HTTP-based client for opencode agents to communicate with MCP Agent Mail. Includes functions: register_agent, send_message, fetch_inbox, acknowledge_message, reserve_file_paths, release_file_reservations, get_project_key. Tested import and get_project_key() function."}
{"id":"opencode-52k","title":"Implement headless worker script","description":"Create 30-line stateless headless worker that claims Beads tasks, reserves files via MCP, executes via opencode, and exits for PM2 restart","design":"## Headless Worker Implementation\n\n### File Location\n~/.config/opencode/bin/headless-worker.js\n\n### Worker Lifecycle (Simple 30-line stateless script)\n```javascript\n#!/usr/bin/env node\n\nconst { execSync } = require('child_process');\n\nfunction run(cmd) {\n  try {\n    return execSync(cmd, { encoding: 'utf8' }).trim();\n  } catch (error) {\n    console.error(`Command failed: ${cmd}`);\n    throw error;\n  }\n}\n\n// 1. Poll Beads for available tasks\nconst readyOutput = run('bd ready');\nif (!readyOutput || readyOutput.includes('No ready work')) {\n  console.log('No tasks available, sleeping 5s then exiting');\n  setTimeout(() =\u003e process.exit(0), 5000);\n  return;\n}\n\n// 2. Extract task_id from output\nconst taskId = readyOutput.split(' ')[0];\nconsole.log(`Claimed task: ${taskId}`);\n\n// 3. Reserve file paths via MCP\ntry {\n  run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n} catch (error) {\n  console.log('File reservation denied, retrying...');\n  // Retry logic up to 3x\n  for (let i = 0; i \u003c 3; i++) {\n    try {\n      setTimeout(() =\u003e {}, 5000);\n      run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n      break;\n    } catch (retryError) {\n      if (i === 2) {\n        console.log('Reservation failed after 3 retries, exiting');\n        process.exit(1);\n      }\n    }\n  }\n}\n\n// 4. Execute task using opencode\ntry {\n  run(`opencode-task ${taskId}`);\n  \n  // 5. On success - complete task\n  run(`bd close ${taskId} --reason=\"Completed\"`);\n  console.log(`Task ${taskId} completed successfully`);\n} catch (error) {\n  // 6. On failure - create dependent task (if applicable)\n  console.error(`Task ${taskId} failed: ${error.message}`);\n  // Dependent task creation happens in CI/CD or review stage\n}\n\n// 7. Release file reservations via MCP\nrun(`python3 -c \"from mcp_agent_mail_client import release_file_reservations; import asyncio; asyncio.run(release_file_reservations(agent_name='headless-worker'))\"}`);\n\n// 8. Exit -\u003e PM2 restarts -\u003e claims next task\nprocess.exit(0);\n```\n\n### Key Features\n- **Stateless**: Worker exits after each task, PM2 restarts\n- **File Reservations**: Uses existing MCP Agent Mail functions\n- **No Custom Endpoints**: Leverages existing infrastructure\n- **Error Handling**: Retry logic for file reservations\n- **Exit on Completion**: PM2 auto-restarts for next task\n\n### Required Components\n- Beads task claiming (bd ready, bd show, bd close)\n- MCP file reservations (reserve_file_paths, release_file_reservations)\n- Task execution via opencode (opencode-task \u003ctask-id\u003e)\n- Exit on completion (PM2 auto-restarts)\n- Error handling -\u003e dependent task creation\n\n### File Reservation Flow\n```bash\n# Before task execution\npython3 -c \"\nfrom mcp_agent_mail_client import reserve_file_paths\nimport asyncio\nasyncio.run(reserve_file_paths(\n    agent_name='headless-worker',\n    paths=['src/**/*', 'tests/**/*'],\n    ttl_seconds=3600\n))\n\"\n\n# After task completion\npython3 -c \"\nfrom mcp_agent_mail_client import release_file_reservations\nimport asyncio\nasyncio.run(release_file_reservations(agent_name='headless-worker'))\n\"\n```\n\n### MCP Agent Mail Integration\n**What MCP Agent Mail Already Handles:**\n- File path reservations (prevents concurrent edits)\n- TTL-based auto-release (if worker crashes)\n- Agent registration tracking\n- Message passing for coordination\n- Lock conflict resolution (grants first, denies second)\n\n**No Custom Endpoints Needed!**\n\n### Edge Cases\n1. **Worker crashes**: PM2 auto-restarts, MCP detects no heartbeat and auto-releases task lock after 5min\n2. **No tasks available**: Worker sleeps 5s, exits, PM2 restarts\n3. **File reservation denied**: Retry 3x with 5s delay, exit if still denied\n4. **Task execution failure**: Create dependent task, release reservations, exit\n5. **Network partition**: MCP server heartbeat timeout triggers lock auto-release, tasks re-claimable on reconnect\n6. **All tasks fail repeatedly**: PM2 restart limit (10x) reached, instance stops claiming new tasks, alerts developer\n7. **Machine runs out of RAM**: PM2 max_memory_restart threshold triggers worker restart\n8. **Two workers claim same task simultaneously**: MCP grants lock to first requester, denies second (worker exits, claims different task)\n9. **Worker stuck in infinite loop**: MCP detects no heartbeat, auto-releases lock after timeout, another worker reclaims task\n\n### Success Criteria\n- Worker can poll Beads for tasks\n- Worker can reserve files via MCP\n- Worker can execute opencode tasks\n- Worker completes and exits (PM2 restarts)\n- File reservations prevent git conflicts\n- Failed tasks create dependent tasks automatically","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-08T12:19:32.682371+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:19:32.682371+05:30"}
{"id":"opencode-5sk","title":"Migrate Factory Continuous Learning System to cass_memory playbook","description":"Extract high-value patterns from Factory CLS (codebase_intelligence.json, git_patterns.json, library_insights.json, learning_metrics.json, success_patterns.json, failure_patterns.json, project_templates.json) and convert to cass_memory playbook rules. Create starter playbook at ~/.config/opencode/.beads/starters/factory-legacy.yaml. Validate rules with evidence and migrate unique aggregate metrics (technology usage, project templates) as supplementary content.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:57.34149+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:14:01.569378+05:30","closed_at":"2026-01-06T14:14:01.569378+05:30","close_reason":"Created factory-legacy.yaml starter playbook at .beads/starters/ with 979 lines of evidence-based patterns migrated from Factory CLS. Includes success patterns, anti-patterns, task granularity rules, full-stack templates, and quality gates with historical metrics from 50+ projects","dependencies":[{"issue_id":"opencode-5sk","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:56:57.342438+05:30","created_by":"buddhi"}]}
{"id":"opencode-67n","title":"Update AGENTS.md with prompt caching documentation","description":"Add prompt caching section to AGENTS.md documenting GPTCache integration, cache configuration, and usage guidelines for reducing LLM costs and improving response times.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T12:32:18.368024+05:30","created_by":"buddhi","updated_at":"2026-01-07T12:33:21.540248+05:30","closed_at":"2026-01-07T12:33:21.540248+05:30","close_reason":"Added comprehensive GPTCache documentation to AGENTS.md with setup, configuration, cache behavior, control commands, and benefits. Updated session-start.sh to check GPTCache. Added GPTCache installation to opencode-init (Step 8) with Python 3.10+ check and automatic server start."}
{"id":"opencode-6n7","title":"Migrate MCP Agent Mail integration to opencode","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.15804+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:51.645878+05:30","closed_at":"2026-01-06T14:10:51.645878+05:30","close_reason":"Completed: MCP Agent Mail client and MESSAGE_FORMATS migrated"}
{"id":"opencode-7fm","title":"Test opencode-init and workspace-init scripts","description":"Test both scripts to ensure they work correctly: opencode-init installs tools and configures PATH, workspace-init initializes cass_memory and beads for projects.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T19:37:39.946689+05:30","created_by":"buddhi","updated_at":"2026-01-06T19:39:40.284229+05:30","closed_at":"2026-01-06T19:39:40.284229+05:30","close_reason":"Both scripts tested successfully. opencode-init detects tools and offers PATH configuration. workspace-init shows help correctly. Scripts are ready for use."}
{"id":"opencode-7rh","title":"Migrate Factory skills to opencode (task-breakdown, feature-planning, complex-project)","description":"Copy Factory skills (task-breakdown, feature-planning, complex-project) from ~/.factory/skills/ to ~/.config/opencode/skills/. Update references to use cass_memory for context before generating tasks. Ensure skills work with bd task creation and cass_memory context queries.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T11:57:25.543582+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:09:26.317058+05:30","closed_at":"2026-01-06T14:09:26.317058+05:30","close_reason":"All 3 skills migrated from Factory droids: complex-project, feature-planning, task-breakdown","dependencies":[{"issue_id":"opencode-7rh","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:57:25.54465+05:30","created_by":"buddhi"}]}
{"id":"opencode-7u8","title":"Convert generate-tasks.md - remove Factory dependencies","description":"Remove MCP Agent Mail registration code and session initialization blocks from agent/generate-tasks.md. Keep task atomicity validation, multi-level hierarchy, parallel execution tracks, and Senior Engineer Framework intelligence gathering.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.007528+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:51:42.567041+05:30","closed_at":"2026-01-06T18:51:42.567041+05:30","close_reason":"Removed MCP Agent Mail Integration section (lines 65-134) and Implementation Note (lines 417-449). Kept task atomicity validation, multi-level hierarchy, parallel execution tracks, and Senior Engineer Framework intelligence gathering."}
{"id":"opencode-8eu","title":"Create workspace-init script","description":"Create ~/.config/opencode/bin/workspace-init script that initializes git repo (if missing), runs cm init --repo (REQUIRED), and initializes beads (bd init). Optional osgrep models download. Replaces Factory's workspace-init for opencode.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T19:37:39.946822+05:30","created_by":"buddhi","updated_at":"2026-01-06T19:39:11.029397+05:30","closed_at":"2026-01-06T19:39:11.029397+05:30","close_reason":"Created ~/.config/opencode/bin/workspace-init script with git init, cm init --repo (REQUIRED), and bd init"}
{"id":"opencode-8tx","title":"Design quality gates and integration points","description":"Design CI/CD quality gates, pre-commit hooks, and Beads integration","design":"## Quality Gates Design\n\n### CI/CD Pipeline Gates (Stage 3, 4, 5, 6)\n**Stage 3: Static Analysis \u0026 Security**\n- Linting: ESLint, Prettier, Black, pylint\n- Security: Snyk, OWASP ZAP, npm audit, pip-audit\n- Complexity: Cyclomatic complexity ≤ 10\n- Duplicates: ≤ 3% duplication\n- Dependencies: No vulnerable dependencies\n\n**Stage 4: Test Execution**\n- Unit tests: 100% pass rate\n- Integration tests: 100% pass rate\n- E2E tests: 100% pass rate\n- Coverage: ≥ 80%\n- Flaky tests: ≤ 1% rate\n- Performance: No regression\n\n**Stage 5: Code Review**\n- PR size: ≤ 400 lines\n- TODO/FIXME: 0 comments\n- Debug statements: 0 console.log/debugger\n- Documentation: All functions documented\n- Migration guide: Required for breaking changes\n\n**Stage 6: Deployment**\n- Staging: Successful deployment\n- Smoke tests: All pass\n- Health checks: All pass\n- Monitoring: Configured\n- Error tracking: Configured (Sentry)\n- Rollback: Plan tested\n\n### Pre-commit Hooks (Husky + lint-staged)\n**Before commit:**\n- JS/TS: eslint --fix, prettier --write, tsc --noEmit\n- Python: black, pylint, mypy\n\n### Beads Integration\nEach task has:\n- stage field (0-6)\n- quality_gates array with check commands\n- on_failure task creation config\n- max_retries setting\n- retry_backoff array","notes":"See parent epic: opencode-lsl","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-08T11:51:56.197709+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:00:35.07025+05:30","dependencies":[{"issue_id":"opencode-8tx","depends_on_id":"opencode-h2t","type":"blocks","created_at":"2026-01-08T11:52:58.382496+05:30","created_by":"buddhi"},{"issue_id":"opencode-8tx","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.141076+05:30","created_by":"buddhi"}]}
{"id":"opencode-908","title":"Create opencode-init script","description":"Create ~/.config/opencode/bin/opencode-init script that installs cass_memory (cm), beads CLI (bd), beads viewer (bv), and osgrep if missing. Adds ~/.config/opencode/bin to PATH automatically. Replaces Factory's droid-init for opencode.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T19:37:39.947307+05:30","created_by":"buddhi","updated_at":"2026-01-06T19:39:10.943013+05:30","closed_at":"2026-01-06T19:39:10.943013+05:30","close_reason":"Created ~/.config/opencode/bin/opencode-init script with installation for cm, bd, bv, osgrep and PATH configuration"}
{"id":"opencode-9bz","title":"Migrate droids from Factory CLI to opencode agent/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.160759+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:51.643812+05:30","closed_at":"2026-01-06T14:10:51.643812+05:30","close_reason":"Completed: All droids migrated and path references updated"}
{"id":"opencode-9zc","title":"Convert research droids - remove Factory dependencies","description":"Remove MCP Agent Mail registration code from 9 research droids: codebase-researcher, context-researcher, git-history-analyzer, library-source-reader, domain-specialist, best-practices-researcher, file-picker-agent, semantic-search, figma-design-extractor. Keep core research capabilities and methodology.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:43:01.006775+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:43:44.819196+05:30","closed_at":"2026-01-06T18:43:44.819196+05:30","close_reason":"Duplicate task, replaced by opencode-wva"}
{"id":"opencode-g4a","title":"Document metrics collection and learning system","description":"Design metrics collection, Prometheus integration, and cass memory learning system","design":"## Metrics Collection \u0026 Learning System\n\n### Metrics to Track\n**Quality Metrics:**\n- Code coverage percentage\n- Defect escape rate (bugs in production)\n- Mean time to detection (MTTD)\n- Mean time to resolution (MTTR)\n- Technical debt ratio\n- Code churn (lines changed/week)\n\n**Velocity Metrics:**\n- Lead time (idea to production)\n- Cycle time (start to finish)\n- Throughput (tasks/week)\n- Task completion rate\n- Average task duration\n- Deployment frequency\n\n**Workflow Metrics:**\n- Test execution time\n- Pipeline success rate\n- Flaky test rate\n- Average PR size\n- Review turnaround time\n- Rollback frequency\n\n**AI Assistance Metrics:**\n- AI task completion rate\n- AI-generated code acceptance rate\n- Time saved by AI assistance\n- AI prompt success rate\n- Human intervention rate\n\n### Metrics Collection System\n**Prometheus Metrics Export:**\n```javascript\nconst client = require('prom-client');\n\n// Task completion duration histogram\nconst taskDuration = new client.Histogram({\n  name: 'opencode_task_duration_seconds',\n  help: 'Task completion duration in seconds',\n  labelNames: ['stage', 'success'],\n  buckets: [60, 300, 900, 1800, 3600]\n});\n\n// Stage failures counter\nconst stageFailures = new client.Counter({\n  name: 'opencode_stage_failures_total',\n  help: 'Total stage failures',\n  labelNames: ['stage', 'failure_type']\n});\n\n// AI assistance success rate gauge\nconst aiSuccessRate = new client.Gauge({\n  name: 'opencode_ai_success_rate',\n  help: 'AI task success rate',\n  labelNames: ['agent_type']\n});\n```\n\n### Cassandra (cass_memory) Learning\n**Failure Pattern Learning:**\n```javascript\nconst learning = {\n  extractFailurePatterns: async () =\u003e {\n    const recentFailures = await queryRecentFailures(7);\n    const patterns = groupBy(recentFailures, f =\u003e f.stage + ':' + f.failureType);\n    \n    const learnedPatterns = Object.entries(patterns).map(([key, failures]) =\u003e {\n      const [stage, failureType] = key.split(':');\n      return {\n        pattern_id: 'p-' + generateId(),\n        stage: stage,\n        failure_type: failureType,\n        occurrence_count: failures.length,\n        last_occurrence: failures[0].timestamp,\n        resolution_success_rate: calculateSuccessRate(failures),\n        avg_time_to_resolve: calculateAvgTime(failures),\n        recommended_action: getRecommendedAction(stage, failureType)\n      };\n    });\n    \n    await storeInCassMemory('failure_patterns', learnedPatterns);\n  },\n  \n  extractSuccessPatterns: async () =\u003e {\n    const recentSuccesses = await queryRecentSuccesses(7);\n    const patterns = groupBy(recentSuccesses, s =\u003e s.agentType + ':' + s.taskType);\n    \n    const learnedPatterns = Object.entries(patterns).map(([key, successes]) =\u003e {\n      const [agentType, taskType] = key.split(':');\n      return {\n        pattern_id: 'p-' + generateId(),\n        approach: agentType + '_' + taskType,\n        agent_type: agentType,\n        task_type: taskType,\n        success_rate: successes.length / getAttemptCount(agentType, taskType),\n        avg_time_to_complete: calculateAvgTime(successes),\n        recommended: successes.length \u003e= 5\n      };\n    });\n    \n    await storeInCassMemory('success_patterns', learnedPatterns);\n  }\n};\n```\n\n**Context Recommendations:**\n```bash\n# Before starting a task\ncm context \"implementing user authentication\" --json\n\n# Returns:\n{\n  \"relevantBullets\": [\n    {\n      \"rule_id\": \"b-8f3a2c\",\n      \"rule\": \"Always write unit tests before implementing authentication logic\",\n      \"confidence\": 0.95,\n      \"evidence_count\": 42\n    }\n  ],\n  \"antiPatterns\": [\n    {\n      \"pattern_id\": \"ap-7d1b4f\",\n      \"pattern\": \"Never store passwords in plain text\",\n      \"confidence\": 0.99,\n      \"evidence_count\": 156\n    }\n  ],\n  \"historySnippets\": [\n    {\n      \"session_id\": \"ses-abc123\",\n      \"task\": \"Implement OAuth2 login\",\n      \"outcome\": \"success\",\n      \"duration\": \"45 min\",\n      \"approach\": \"test_driven_development\"\n    }\n  ]\n}\n```\n\n### Monitoring Stack\n**Components:**\n- Prometheus: Metrics collection\n- Grafana: Dashboards and visualization\n- Sentry: Error tracking\n- PagerDuty: Alerting\n- ELK Stack: Log aggregation\n\n**Health Check Endpoints:**\n- `/health` - Overall health\n- `/readiness` - Ready to accept traffic\n- `/metrics` - Prometheus metrics\n- `/version` - Service version","notes":"See parent epic: opencode-lsl","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T11:51:56.195022+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:00:35.177005+05:30","dependencies":[{"issue_id":"opencode-g4a","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.296579+05:30","created_by":"buddhi"}]}
{"id":"opencode-h2t","title":"Design enhanced iterative development workflow stages","description":"Design enhanced 6-stage workflow with quality gates and failure handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T11:51:56.199209+05:30","created_by":"buddhi","updated_at":"2026-01-08T11:54:18.171884+05:30","closed_at":"2026-01-08T11:54:18.171884+05:30","close_reason":"Completed: Enhanced 6-stage workflow designed with quality gates and failure handling","dependencies":[{"issue_id":"opencode-h2t","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.062286+05:30","created_by":"buddhi"}]}
{"id":"opencode-hfi","title":"Convert prd.md - remove Factory dependencies","description":"Remove MCP Agent Mail registration code, session initialization blocks, and 'REQUIRED MCP' error raising from agent/prd.md. Keep atomicity rules, clarifying questions workflow, Figma integration, and Senior Engineer Framework methodology.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.01981+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:49:26.157494+05:30","closed_at":"2026-01-06T18:49:26.157494+05:30","close_reason":"Removed MCP Agent Mail registration code (lines 55-106), session initialization block, and implementation note (lines 469-503). Kept atomicity rules, clarifying questions workflow, Figma integration, and Senior Engineer Framework methodology.","dependencies":[{"issue_id":"opencode-hfi","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:01.020392+05:30","created_by":"buddhi"}]}
{"id":"opencode-ivn","title":"Migrate skills from Factory CLI to opencode skills/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.163209+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:10:51.64045+05:30","closed_at":"2026-01-06T14:10:51.64045+05:30","close_reason":"Completed: Skills copied and references updated"}
{"id":"opencode-k4w","title":"Create implementation plan for enhanced workflow","description":"Create 8-week implementation plan with phases and milestones","design":"## Implementation Plan - Enhanced Iterative Workflow\n\n### Phase 1: Foundation (Week 1-2)\n**Week 1: Core Workflow Enhancement**\n- Implement Stage 0 (Discovery \u0026 Planning) enhancements\n- Implement Stage 1 (Test Specification) with test-specialist agent\n- Enhance Stage 2 (Code Implementation) with quality checks\n- Implement Stage 3 (Static Analysis \u0026 Security Scanning)\n- Integrate linting, formatting, and security scanning tools\n\n**Week 2: CI/CD Integration**\n- Create GitHub Actions workflow for CI/CD\n- Implement Stage 4 (Test Execution) automation\n- Implement Stage 5 (Code Review) automation\n- Implement Stage 6 (Deployment \u0026 Monitoring)\n- Set up staging environment\n\n### Phase 2: Automated Failure Handling (Week 3-4)\n**Week 3: Failure Detection \u0026 Task Creation**\n- Implement test output parsing\n- Implement review comment parsing\n- Implement automated task creation for failures\n- Implement priority determination logic\n- Test failure detection and task creation\n\n**Week 4: Retry Logic \u0026 Learning**\n- Implement retry logic with exponential backoff\n- Implement max retries exceeded handling\n- Implement failure pattern learning\n- Implement success pattern learning\n- Integrate with cass_memory\n\n### Phase 3: Metrics \u0026 Monitoring (Week 5-6)\n**Week 5: Metrics Collection**\n- Implement metrics collection system\n- Set up Prometheus metrics endpoint\n- Create Grafana dashboard\n- Track quality metrics\n- Track velocity metrics\n\n**Week 6: Monitoring \u0026 Alerting**\n- Set up error tracking (Sentry)\n- Implement health check endpoints\n- Set up alerting (PagerDuty, Slack)\n- Implement log aggregation (ELK)\n- Test monitoring and alerting\n\n### Phase 4: Testing \u0026 Polish (Week 7-8)\n**Week 7: End-to-End Testing**\n- Create test scenarios for all stages\n- Test automated task creation\n- Test retry logic\n- Test failure learning\n- Test metrics collection\n\n**Week 8: Documentation \u0026 Deployment**\n- Write documentation for new workflow\n- Create troubleshooting guide\n- Train team on new workflow\n- Deploy to production\n- Monitor and iterate\n\n### Success Metrics\n**Workflow Efficiency:**\n- 3-5x faster task execution (parallelism)\n- 93% automation (vs 70% originally)\n- \u003c 10% human intervention rate\n- \u003c 5 min feedback loop time (CI/CD)\n\n**Quality Improvements:**\n- 80%+ test coverage\n- 0 critical security vulnerabilities\n- \u003c 1% flaky test rate\n- \u003c 5% bug escape rate to production\n\n**Velocity Improvements:**\n- 2-3x higher throughput (tasks/week)\n- 50% shorter cycle time\n- 80%+ task completion rate\n- \u003c 5% task abandonment rate\n\n### Dependencies \u0026 Prerequisites\n**Required Tools:**\n- PM2 (process management)\n- GitHub Actions (CI/CD)\n- pytest/jest (test runners)\n- ESLint, Prettier, Black (linting/formatting)\n- Snyk (security scanning)\n- Prometheus/Grafana (metrics)\n- Sentry (error tracking)\n- PagerDuty (alerting)\n\n**New Agents to Implement:**\n- test-specialist: Test generation and execution\n- code-reviewer: Automated code review\n- deployment-specialist: Deployment automation\n\n**Integration Points:**\n- Beads task queue (already installed)\n- MCP Agent Mail (already installed)\n- cass_memory (already installed)\n- orchestrator (already installed)","notes":"See parent epic: opencode-lsl","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T11:51:56.195264+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:00:35.237077+05:30","dependencies":[{"issue_id":"opencode-k4w","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.374805+05:30","created_by":"buddhi"}]}
{"id":"opencode-kx9","title":"Define failure detection and task creation patterns","description":"Define automatic task creation patterns for test failures, review comments, and deployment failures","design":"## Failure Detection \u0026 Task Creation Patterns\n\n### Test Failure Detection (Stage 4)\n**Parse test output (pytest, jest, etc.)**\n- Extract failing test names\n- Capture error messages and stack traces\n- Identify failure types (bug, flaky, performance)\n\n**Automatic Task Creation:**\n```javascript\nfailingTests.forEach(test =\u003e {\n  bd.create({\n    title: \"Fix failing test: \" + test.name,\n    description: \"Test failed in \" + test.file + \": \" + test.error,\n    type: 'bug',\n    priority: determinePriority(test.error),\n    depends_on: [currentStage4TaskId],\n    metadata: {\n      test_file: test.file,\n      test_name: test.name,\n      error_message: test.error,\n      stack_trace: test.stack,\n      failure_type: test.failureType\n    }\n  });\n});\n```\n\n**Priority Mappings:**\n- P0: Security test, core functionality\n- P1: Integration/E2E test failure\n- P2: Unit test edge case\n- P3: Performance degradation\n\n### Review Comment Detection (Stage 5)\n**Parse PR comments (GitHub/GitLab API)**\n- Extract comment body, file, line\n- Classify by type: bug, style, architecture, performance, security, documentation, accessibility\n\n**Automatic Task Creation:**\n```javascript\ncommentsByType.forEach(([type, comments]) =\u003e {\n  bd.create({\n    title: getTaskTitle(type),\n    description: formatComments(comments),\n    type: 'improvement',\n    priority: getPriority(type),\n    depends_on: [currentStage5TaskId],\n    metadata: { comment_type: type, count: comments.length }\n  });\n});\n```\n\n**Task Types:**\n- security → \"Fix Security Issues\" (P0)\n- bug → \"Fix Review Bugs\" (P0)\n- architecture → \"Refactor Architecture Issues\" (P1)\n- performance → \"Optimize Performance Issues\" (P1)\n- accessibility → \"Fix Accessibility Issues\" (P1)\n- documentation → \"Add Missing Documentation\" (P2)\n- style → \"Address Style Comments\" (P3)\n\n### Deployment Failure Detection (Stage 6)\n**Monitor deployment events**\n- Deployment failures\n- Smoke test failures\n- Health check failures\n\n**Automatic Task Creation:**\n- P0 \"Rollback failed deployment\" (immediate)\n- P0 \"Investigate deployment failure\" (after rollback)\n- P0 \"Fix failing smoke tests\"\n- P0 \"Fix service health issues\"\n\n### Retry Logic\n**Max Retries:**\n- Stage 0: 1 (manual)\n- Stage 1-5: 3 retries\n- Stage 6: 1 (manual)\n\n**Backoff:**\n- Retry 1: Immediate\n- Retry 2: 5 min\n- Retry 3: 15 min\n\n**Max Retries Exceeded:**\n- Alert developer (email/Slack)\n- Mark task as blocked\n- Create \"Manual Intervention Required\" task\n- Stop auto-requeuing","notes":"See parent epic: opencode-lsl","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-08T11:52:26.067097+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:00:35.124562+05:30","dependencies":[{"issue_id":"opencode-kx9","depends_on_id":"opencode-h2t","type":"blocks","created_at":"2026-01-08T11:52:26.06853+05:30","created_by":"buddhi"},{"issue_id":"opencode-kx9","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.219063+05:30","created_by":"buddhi"}]}
{"id":"opencode-lq1","title":"Migrate Factory droids to opencode (orchestrator, PRD, generate-tasks, task-coordinator, research droids)","description":"Migrate all Factory droid definitions to ~/.config/opencode/droids/. Adapt orchestrator (2000+ lines) to use cass_memory instead of Factory CLS. Update AGENTS.md to include droid directory. Research droids (codebase-researcher, git-history-analyzer, context-researcher, best-practices-researcher, library-source-reader, domain-specialist) remain as-is. PRD and task droids adapted for opencode context.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:57:02.530412+05:30","created_by":"buddhi","updated_at":"2026-01-06T14:14:01.606365+05:30","closed_at":"2026-01-06T14:14:01.606365+05:30","close_reason":"All 14 agents already migrated from Factory droids: orchestrator (726 lines), PRD, generate-tasks, task-coordinator, 7 research droids, semantic-search, figma-design-extractor, MESSAGE_FORMATS, README-ai-dev-tasks. Memory paths updated from ~/.factory to ~/.config/opencode","dependencies":[{"issue_id":"opencode-lq1","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:57:02.531745+05:30","created_by":"buddhi"}]}
{"id":"opencode-lsl","title":"OpenCode Headless Swarm - Enhanced Workflow Design Epic","description":"Epic for implementing enhanced iterative development workflow with 6 stages, automatic failure handling, CI/CD integration, and continuous learning system. This is a comprehensive enhancement to the OpenCode Headless Swarm architecture.","design":"## OpenCode Headless Swarm - Complete Architecture\n\n### Overview\nThis epic implements a comprehensive 6-stage iterative development workflow with parallel execution, automatic failure handling, CI/CD integration, and continuous learning system. The architecture leverages existing opencode agents and tools while adding minimal new infrastructure.\n\n### Core Architecture\n\n#### 6-Stage Workflow\n1. **Stage 0: Discovery \u0026 Planning** - PRD validation, risk assessment, atomic task generation\n2. **Stage 1: Test Specification** - Automated test generation with test-specialist agent\n3. **Stage 2: Code Implementation** - Enhanced with quality checks, type safety, error handling\n4. **Stage 3: Static Analysis \u0026 Security** - Linting, security scanning, complexity analysis\n5. **Stage 4: Test Execution** - Automated testing with failure detection and task creation\n6. **Stage 5: Code Review** - Automated review checks, comment parsing, task creation\n7. **Stage 6: Deployment \u0026 Monitoring** - Deployment automation, monitoring setup\n\n#### Headless Swarm Architecture\n**Process Management (PM2):**\n- 4 parallel worker instances (configurable: pm2 scale headless-swarm 8)\n- Stateless workers: claim → execute → exit (PM2 restarts)\n- Auto-restart on crash (max 10 restarts)\n- Memory limit: 1GB (max_memory_restart)\n- No custom CLI - uses PM2 built-in commands\n\n**Task Queue (Beads):**\n- Dependency graph for task orchestration\n- Worker polls: `bd ready` for available tasks\n- Worker claims: `bd update \u003cid\u003e --status in_progress`\n- Worker completes: `bd close \u003cid\u003e --reason=\"Completed\"`\n- Failed tasks auto-create dependent tasks\n\n**File Locking (MCP Agent Mail):**\n- Uses existing `reserve_file_paths()` and `release_file_reservations()`\n- Prevents concurrent edits (no git conflicts)\n- TTL-based auto-release (if worker crashes)\n- Lock conflict resolution (grants first, denies second)\n- No custom endpoints needed\n\n### Core Features\n\n#### 1. Automatic Task Creation\n**Test Failures (Stage 4):**\n- Parse test output (pytest, jest, etc.)\n- Extract failing test names, errors, stack traces\n- Create individual tasks: \"Fix failing test: \u003ctest_name\u003e\"\n- Priority mapping: P0 (security/core), P1 (integration/E2E), P2 (unit edge case), P3 (performance)\n\n**Review Comments (Stage 5):**\n- Parse PR comments (GitHub/GitLab API)\n- Classify by type: bug, style, architecture, performance, security, documentation, accessibility\n- Create grouped tasks by type\n- Task types: \"Fix Security Issues\" (P0), \"Fix Review Bugs\" (P0), \"Refactor Architecture Issues\" (P1), \"Optimize Performance Issues\" (P1), \"Fix Accessibility Issues\" (P1), \"Add Missing Documentation\" (P2), \"Address Style Comments\" (P3)\n\n**Deployment Failures (Stage 6):**\n- Monitor deployment events\n- Create tasks: \"Rollback failed deployment\" (P0), \"Investigate deployment failure\" (P0), \"Fix failing smoke tests\" (P0), \"Fix service health issues\" (P0)\n\n#### 2. Retry Logic\n**Max Retries per Stage:**\n- Stage 0 (Discovery): 1 retry (manual intervention)\n- Stage 1 (Test Spec): 3 retries\n- Stage 2 (Implementation): 3 retries\n- Stage 3 (Static Analysis): 3 retries\n- Stage 4 (Test Execution): 3 retries\n- Stage 5 (Code Review): 3 retries\n- Stage 6 (Deployment): 1 retry (manual intervention)\n\n**Exponential Backoff:**\n- Retry 1: Immediate\n- Retry 2: 5 min\n- Retry 3: 15 min\n\n**Max Retries Exceeded:**\n- Alert developer (email, Slack webhook)\n- Mark task as blocked\n- Create \"Manual Intervention Required\" task\n- Stop automatic re-queuing for this task\n\n#### 3. Cass Memory Integration\n**Failure Pattern Learning:**\n- Track: Stage failures, failure types, occurrence count, resolution success rate, avg time to resolve\n- Extract patterns from last 7 days\n- Recommended action based on patterns\n- Store in cass_memory as `failure_patterns`\n\n**Success Pattern Learning:**\n- Track: Agent type, task type, success rate, avg time to complete\n- Extract patterns from last 7 days\n- Recommended: Only if ≥5 data points\n- Store in cass_memory as `success_patterns`\n\n**Context Recommendations:**\n```bash\n# Before starting task\ncm context \"implementing user authentication\" --json\n\n# Returns:\n{\n  \"relevantBullets\": [\n    {\n      \"rule_id\": \"b-8f3a2c\",\n      \"rule\": \"Always write unit tests before implementing authentication logic\",\n      \"confidence\": 0.95,\n      \"evidence_count\": 42\n    }\n  ],\n  \"antiPatterns\": [\n    {\n      \"pattern_id\": \"ap-7d1b4f\",\n      \"pattern\": \"Never store passwords in plain text\",\n      \"confidence\": 0.99,\n      \"evidence_count\": 156\n    }\n  ]\n}\n```\n\n### Quality Gates\n\n#### CI/CD Pipeline (Stages 3-6)\n**Stage 3: Static Analysis \u0026 Security:**\n- Linting: ESLint, Prettier, Black, pylint\n- Security: Snyk, OWASP ZAP, npm audit, pip-audit\n- Complexity: Cyclomatic complexity ≤ 10\n- Duplicates: ≤ 3% duplication\n- Dependencies: No vulnerable dependencies\n\n**Stage 4: Test Execution:**\n- Unit tests: 100% pass rate\n- Integration tests: 100% pass rate\n- E2E tests: 100% pass rate\n- Coverage: ≥ 80%\n- Flaky tests: ≤ 1% rate\n- Performance: No regression\n\n**Stage 5: Code Review:**\n- PR size: ≤ 400 lines\n- TODO/FIXME: 0 comments\n- Debug statements: 0 console.log/debugger\n- Documentation: All functions documented\n- Migration guide: Required for breaking changes\n\n**Stage 6: Deployment:**\n- Staging: Successful deployment\n- Smoke tests: All pass\n- Health checks: All pass\n- Monitoring: Configured\n- Error tracking: Configured (Sentry)\n- Rollback: Plan tested\n\n### Metrics \u0026 Monitoring\n\n#### Metrics to Track\n**Quality Metrics:**\n- Code coverage percentage\n- Defect escape rate (bugs in production)\n- Mean time to detection (MTTD)\n- Mean time to resolution (MTTR)\n- Technical debt ratio\n- Code churn (lines changed/week)\n\n**Velocity Metrics:**\n- Lead time (idea to production)\n- Cycle time (start to finish)\n- Throughput (tasks/week)\n- Task completion rate\n- Average task duration\n- Deployment frequency\n\n**Workflow Metrics:**\n- Test execution time\n- Pipeline success rate\n- Flaky test rate\n- Average PR size\n- Review turnaround time\n- Rollback frequency\n\n**AI Assistance Metrics:**\n- AI task completion rate\n- AI-generated code acceptance rate\n- Time saved by AI assistance\n- AI prompt success rate\n- Human intervention rate\n\n#### Monitoring Stack\n- **Prometheus**: Metrics collection\n- **Grafana**: Dashboards and visualization\n- **Sentry**: Error tracking\n- **PagerDuty**: Alerting\n- **ELK Stack**: Log aggregation\n\n### Success Metrics\n\n#### Workflow Efficiency\n- 3-5x faster task execution (parallelism)\n- 93% automation (vs 70% originally)\n- \u003c 10% human intervention rate\n- \u003c 5 min feedback loop time (CI/CD)\n\n#### Quality Improvements\n- 80%+ test coverage\n- 0 critical security vulnerabilities\n- \u003c 1% flaky test rate\n- \u003c 5% bug escape rate to production\n\n#### Velocity Improvements\n- 2-3x higher throughput (tasks/week)\n- 50% shorter cycle time\n- 80%+ task completion rate\n- \u003c 5% task abandonment rate\n\n### Implementation Summary\n\n**What We Have (Ready to Use):**\n- ✅ PRD Generator (prd)\n- ✅ Task Breakdown (generate-tasks)\n- ✅ Task Tracking (bd)\n- ✅ Task Prioritization (bv)\n- ✅ Agent Coordination (MCP Agent Mail)\n- ✅ Task Coordinator\n- ✅ Orchestrator\n- ✅ Research Droids (9 types)\n- ✅ Memory System (cass_memory)\n- ❌ PM2 (needs npm install -g pm2)\n\n**What Needs Implementation:**\n1. **PM2 ecosystem configuration** (12 lines)\n2. **Headless worker script** (30 lines)\n3. **test-specialist agent** (new)\n4. **code-reviewer agent** (new)\n5. **deployment-specialist agent** (new)\n6. **CI/CD pipeline** (GitHub Actions)\n7. **Testing infrastructure** (pytest/jest)\n8. **Code quality tools** (ESLint, Prettier, Snyk)\n9. **Monitoring stack** (Prometheus, Grafana, Sentry)\n\n**Total Code to Write:**\n- Headless worker + PM2 config: ~42 lines\n- New specialist agents: ~2000 lines\n- CI/CD pipeline: ~500 lines\n- Test infrastructure: ~800 lines\n- Monitoring integration: ~600 lines\n\n**Implementation Time:**\n- **Phase 1** (Foundation): 2 weeks\n- **Phase 2** (Failure Handling): 2 weeks\n- **Phase 3** (Metrics): 2 weeks\n- **Phase 4** (Testing): 2 weeks\n- **Total**: 8 weeks\n\n### Edge Cases \u0026 Handling\n\n1. **Worker crashes** → PM2 auto-restarts, MCP detects no heartbeat and auto-releases task lock after 5min\n2. **No tasks available** → Worker sleeps 5s, exits, PM2 restarts\n3. **File reservation denied** → Retry 3x with 5s delay, exit if still denied\n4. **Task execution failure** → Create dependent task, release reservations, exit\n5. **Network partition** → MCP server heartbeat timeout triggers lock auto-release, tasks re-claimable on reconnect\n6. **All tasks fail repeatedly** → PM2 restart limit (10x) reached, instance stops claiming new tasks, alerts developer\n7. **Machine runs out of RAM** → PM2 max_memory_restart threshold triggers worker restart\n8. **Two workers claim same task simultaneously** → MCP grants lock to first requester, denies second (worker exits, claims different task)\n9. **Worker stuck in infinite loop** → MCP detects no heartbeat, auto-releases lock after timeout, another worker reclaims task","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-08T11:59:31.071549+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:23:33.19413+05:30"}
{"id":"opencode-o0b","title":"Create hook-based service check architecture for opencode","description":"Design and implement hook-based service check system for opencode. Checks (don't install) if cass_memory, MCP Agent Mail, Beads CLI, and Beads Viewer (bv) are available. Services should be installed independently in tool-agnostic locations (~/.cass-memory, ~/.mcp-agent-mail, ~/.local/bin/). Create ~/.config/opencode/hooks/session-start.sh as main entry point calling individual check hooks.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:32.415663+05:30","created_by":"buddhi","updated_at":"2026-01-06T13:40:48.267364+05:30","closed_at":"2026-01-06T13:40:48.267364+05:30","close_reason":"Implemented hook-based service check system with 5 hooks (session-start.sh, check-cass-memory.sh, check-mcp-agent-mail.sh, check-beads.sh, check-bv.sh)","dependencies":[{"issue_id":"opencode-o0b","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:56:32.416964+05:30","created_by":"buddhi"}]}
{"id":"opencode-pqy","title":"Investigate and plan agent migration","description":"Research Factory droid changes, identify atomicity improvements, and plan migration strategy. Verify all atomicity changes are present in opencode agents.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T18:42:24.601711+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:54:35.470474+05:30","closed_at":"2026-01-06T18:54:35.470474+05:30","close_reason":"Investigation already complete - verified atomicity changes present, migration plan completed, all conversion tasks executed successfully."}
{"id":"opencode-toi","title":"Clone and install MCP Agent Mail","description":"Clone MCP Agent Mail repository to ~/.mcp_agent_mail, create .env configuration, and install dependencies with uv sync. This is REQUIRED for opencode headless mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.384051+05:30","created_by":"buddhi","updated_at":"2026-01-06T23:46:53.955305+05:30","closed_at":"2026-01-06T23:46:53.955305+05:30","close_reason":"Cloned MCP Agent Mail to ~/.mcp_agent_mail, created .env config, installed Python 3.14 and dependencies with uv sync. Server running on http://127.0.0.1:8765"}
{"id":"opencode-wns","title":"Design opencode hook architecture (session-start.sh, check-cass-memory, check-mcp-agent-mail, check-beads, check-bv)","description":"Create ~/.config/opencode/hooks/ directory and implement session-start.sh as main entry point. Implement 5 check hooks: check-cass-memory.sh (verifies cm installation and config), check-mcp-agent-mail.sh (checks tool-agnostic MCP Agent Mail in ~/.mcp-agent-mail or ~/.factory/mcp_agent_mail), check-beads.sh (verifies bd CLI), check-bv.sh (verifies Beads Viewer). All hooks check-only (no installation), report status with clear messages.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:51.409679+05:30","created_by":"buddhi","updated_at":"2026-01-06T13:40:48.301883+05:30","closed_at":"2026-01-06T13:40:48.301883+05:30","close_reason":"Completed by opencode-o0b - hook directory and all 5 hooks implemented","dependencies":[{"issue_id":"opencode-wns","depends_on_id":"opencode-o0b","type":"blocks","created_at":"2026-01-06T11:56:51.410836+05:30","created_by":"buddhi"}]}
{"id":"opencode-wva","title":"Convert research droids - remove Factory dependencies","description":"Remove MCP Agent Mail registration code from 9 research droids: codebase-researcher, context-researcher, git-history-analyzer, library-source-reader, domain-specialist, best-practices-researcher, file-picker-agent, semantic-search, figma-design-extractor. Keep core research capabilities and methodology.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:43:19.727768+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:53:51.865236+05:30","closed_at":"2026-01-06T18:53:51.865236+05:30","close_reason":"Removed MCP Agent Mail registration code from all 8 research droids. Each file cleaned of Session Initialization sections and MCP Agent Mail Integration blocks. Kept core research capabilities, methodology, and Senior Engineer Framework intelligence gathering.","dependencies":[{"issue_id":"opencode-wva","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:19.728719+05:30","created_by":"buddhi"}]}
{"id":"opencode-yl1","title":"Remove Factory-specific agent files","description":"Delete 12 Factory-specific files from agent/ folder: orchestrator.md, task-coordinator.md, orchestrator.py, enhanced_orchestrator.py, specialized_agents.py, handoff_protocol.py, AGENT_ROLES.yaml, mcp_agent_mail_client.py, MESSAGE_FORMATS.md, README-ai-dev-tasks.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.00827+05:30","created_by":"buddhi","updated_at":"2026-01-06T18:47:47.367276+05:30","closed_at":"2026-01-06T18:47:47.367276+05:30","close_reason":"Removed all 12 Factory-specific files: orchestrator.md, task-coordinator.md, orchestrator.py, enhanced_orchestrator.py, specialized_agents.py, handoff_protocol.py, AGENT_ROLES.yaml, mcp_agent_mail_client.py, MESSAGE_FORMATS.md, README-ai-dev-tasks.md","dependencies":[{"issue_id":"opencode-yl1","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:01.011125+05:30","created_by":"buddhi"}]}
{"id":"opencode-z2f","title":"Create PM2 ecosystem configuration","description":"Create ecosystem.config.js for PM2 process management with headless worker configuration","design":"## PM2 Ecosystem Configuration\n\n### File Location\n~/.config/opencode/ecosystem.config.js\n\n### Configuration\n```javascript\nmodule.exports = {\n  apps: [{\n    name: 'headless-swarm',\n    script: './bin/headless-worker.js',\n    instances: 4,  // 4 parallel workers (configurable)\n    autorestart: true,\n    max_restarts: 10,\n    max_memory_restart: '1G',\n    error_file: '~/.config/opencode/logs/err.log',\n    out_file: '~/.config/opencode/logs/out.log',\n    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    merge_logs: true,\n    kill_timeout: 5000\n  }]\n};\n```\n\n### Key Settings\n- **instances**: 4 parallel workers (scale with: pm2 scale headless-swarm 8)\n- **max_memory_restart**: Restart worker if \u003e 1GB RAM\n- **max_restarts**: Auto-restart up to 10 times\n- **merge_logs**: Combine all worker logs\n- **autorestart**: PM2 auto-restarts crashed workers\n\n### PM2 Commands (No Custom CLI Needed)\n```bash\n# Start workers\npm2 start ecosystem.config.js\n\n# Scale to different worker count\npm2 scale headless-swarm 8    # 8 workers\npm2 scale headless-swarm 2    # 2 workers\n\n# Check status\npm2 list                 # Show all workers and their status\npm2 monit                 # Real-time dashboard\n\n# View logs\npm2 logs                  # Live logs\npm2 logs --lines 100      # Last 100 lines\n\n# Control workers\npm2 stop all              # Stop all workers\npm2 restart all           # Restart all workers\npm2 delete all            # Remove all from PM2\n```\n\n### Integration Points\n- Headless worker script: ./bin/headless-worker.js\n- Beads CLI: bd ready, bd show, bd close\n- MCP Agent Mail: reserve_file_paths, release_file_reservations\n- opencode execution: opencode-task \u003ctask-id\u003e","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-08T12:18:54.583871+05:30","created_by":"buddhi","updated_at":"2026-01-08T12:18:54.583871+05:30"}
