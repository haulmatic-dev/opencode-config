{"id":"opencode-07i","title":"Migrate test suite from Factory CLI to opencode tests/","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T14:07:42.172098+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: Tests migrated","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-0bc","title":"Migrate Factory CLI to opencode with cass_memory","description":"Complete migration of Factory CLI framework to opencode with cass_memory as primary learning system. Includes: Hook-based service checks, MCP Agent Mail, Beads CLI, Beads Viewer (bv), Factory CLS migration to cass_memory rules, droids, skills, test suite, and documentation updates.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-06T11:55:50.677898+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: All Factory CLI components migrated to opencode - droids, skills, tests, docs, MCP integration","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"opencode-0zl","title":"Integrate MCP Agent Mail into opencode-init","description":"Add MCP Agent Mail installation step to ~/.config/opencode/bin/opencode-init. Check Python 3.10+, clone repository if missing, create .env, run uv sync. This is REQUIRED and will fail if installation fails.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.384046+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Added MCP Agent Mail installation (Step 7) to opencode-init. Checks Python 3.14+, clones repository, creates .env, runs uv sync, starts server. This is REQUIRED for opencode headless mode.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-1ly","title":"Create and run local test scenarios","description":"Create test scenarios to validate headless worker, PM2, and Beads integration locally before production rollout","design":"## Create Local Test Scenarios\n\n### Purpose\nCreate test scenarios to validate headless worker, PM2, and Beads integration\n\n### Test Scenarios\n\n#### Scenario 1: Basic Worker Execution\n```bash\n# Create test tasks\nbd create --title=\"Test: Write unit tests\" --type=task --priority=1 --description=\"Write unit tests for feature X\"\nbd create --title=\"Test: Implement feature\" --type=task --priority=1 --description=\"Implement feature X\"\nbd create --title=\"Test: Run tests\" --type=task --priority=1 --description=\"Run tests for feature X\"\n\n# Start PM2 with 1 worker\npm2 start ecosystem.config.js\n\n# Monitor execution\npm2 logs --lines 50\n\n# Expected behavior:\n# 1. Worker claims first task\n# 2. Worker reserves files\n# 3. Worker executes task (via opencode)\n# 4. Worker releases files\n# 5. Worker exits\n# 6. PM2 restarts worker\n# 7. Worker claims next task\n# Repeat...\n\n# After 5 minutes, check task status\nbd list --status=closed\n\n# Stop PM2\npm2 stop all\n```\n\n#### Scenario 2: File Reservation Conflicts\n```bash\n# Start 2 workers\npm2 start ecosystem.config.js\npm2 scale headless-swarm 2\n\n# Create 2 tasks that edit same files\nbd create --title=\"Test: Edit src/utils.js\" --type=task --priority=1 --description=\"Edit utils.js\"\nbd create --title=\"Test: Edit src/utils.js\" --type=task --priority=1 --description=\"Edit utils.js\"\n\n# Monitor logs\npm2 logs\n\n# Expected behavior:\n# 1. Worker 1 claims task 1, reserves files, executes\n# 2. Worker 2 claims task 2, tries to reserve files\n# 3. Worker 2 denied (files already reserved)\n# 4. Worker 2 retries 3x\n# 5. Worker 2 exits\n# 6. PM2 restarts Worker 2\n# 7. Worker 2 claims different task\n\n# Stop PM2\npm2 stop all\n```\n\n#### Scenario 3: Task Failure Handling\n```bash\n# Create a task that will fail\nbd create --title=\"Test: Failing task\" --type=task --priority=1 --description=\"This task should fail and create dependent task\"\n\n# Start PM2 with 1 worker\npm2 start ecosystem.config.js\n\n# Monitor logs\npm2 logs\n\n# Expected behavior:\n# 1. Worker claims task\n# 2. Worker executes task\n# 3. Task fails\n# 4. Worker exits\n# 5. PM2 restarts worker\n# 6. Worker claims next available task\n\n# Check if dependent task was created\nbd ready\n\n# Stop PM2\npm2 stop all\n```\n\n#### Scenario 4: Worker Scaling\n```bash\n# Start with 1 worker\npm2 start ecosystem.config.js\npm2 scale headless-swarm 1\n\n# Create 5 tasks\nfor i in {1..5}; do\n  bd create --title=\"Test: Task $i\" --type=task --priority=1 --description=\"Test task $i\"\ndone\n\n# Monitor execution (should be slow with 1 worker)\npm2 logs\n\n# Scale to 4 workers\npm2 scale headless-swarm 4\n\n# Monitor execution (should be faster with 4 workers)\npm2 logs\n\n# Scale down to 2 workers\npm2 scale headless-swarm 2\n\n# Stop PM2\npm2 stop all\n```\n\n### Verification Checklist\n\n**For Each Scenario:**\n- [ ] PM2 starts successfully\n- [ ] Workers claim tasks from Beads\n- [ ] Workers reserve files via MCP\n- [ ] Workers execute tasks via opencode\n- [ ] Workers release files after completion\n- [ ] Workers exit and PM2 restarts them\n- [ ] Tasks are marked as closed in Beads\n- [ ] No git conflicts occur\n- [ ] Logs show clear execution flow\n\n**Edge Cases:**\n- [ ] Worker crashes -\u003e PM2 restarts\n- [ ] File reservation denied -\u003e Worker retries 3x\n- [ ] No tasks available -\u003e Worker exits, PM2 restarts\n- [ ] Task fails -\u003e Dependent task created\n- [ ] Two workers claim same task -\u003e MCP resolves conflict\n\n### Success Criteria\n- All scenarios execute successfully\n- Workers complete tasks as expected\n- File reservations prevent conflicts\n- PM2 manages worker lifecycle correctly\n- Beads tracks task status accurately\n- Logs provide clear visibility\n- No manual intervention needed during execution","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:50:18.145089+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.622165+05:30"}
{"id":"opencode-3mg","title":"Migrate documentation from Factory CLI to opencode docs/","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T14:07:42.157923+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: Documentation migrated","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-3zc","title":"Document task implementation process with visual guides","description":"Create comprehensive visual diagrams for task implementation, headless worker flow, 6-stage workflow, failure handling, cass memory learning, PM2 management, and local-to-production rollout","design":"# Task Implementation Process - Visual Guide\n\n## Local Development Process (Phase 1)\n\n```mermaid\ngraph TD\n    A[Developer] --\u003e B[Install Code Quality Tools]\n    B --\u003e B1[ESLint, Prettier, Black, Pylint]\n    B1 --\u003e B2[Configure Pre-commit Hooks]\n    B2 --\u003e C[Install PM2]\n    C --\u003e C1[Create ecosystem.config.js]\n    C1 --\u003e D[Implement Headless Worker]\n    D --\u003e D1[Create headless-worker.js]\n    D1 --\u003e E[Create Test Scenarios]\n    E --\u003e E1[Basic Execution]\n    E --\u003e E2[File Conflicts]\n    E --\u003e E3[Task Failures]\n    E --\u003e E4[Worker Scaling]\n    E1 --\u003e F[Run Local Tests]\n    E2 --\u003e F\n    E3 --\u003e F\n    E4 --\u003e F\n    F --\u003e G[Validate Integration]\n    G --\u003e H[Ready for Production]\n    \n    style B fill:#e1f5ff\n    style C fill:#e1f5ff\n    style D fill:#e1f5ff\n    style E fill:#fff4e6\n    style F fill:#e8f5e9\n    style H fill:#d4edda\n```\n\n## Headless Worker Execution Flow\n\n```mermaid\nsequenceDiagram\n    participant PM2 as PM2 Process Manager\n    participant Worker as Headless Worker\n    participant Beads as Beads Task Queue\n    participant MCP as MCP Agent Mail\n    participant OC as opencode\n    \n    PM2-\u003e\u003eWorker: Start worker\n    Worker-\u003e\u003eBeads: bd ready\n    Beads--\u003e\u003eWorker: Task ID\n    Worker-\u003e\u003eMCP: reserve_file_paths()\n    MCP--\u003e\u003eWorker: Granted/Denied\n    \n    alt File Reserved\n        Worker-\u003e\u003eOC: opencode-task \u003ctask-id\u003e\n        OC--\u003e\u003eWorker: Success/Failure\n        \n        alt Task Success\n            Worker-\u003e\u003eBeads: bd close \u003ctask-id\u003e\n            Worker-\u003e\u003eMCP: release_file_reservations()\n            Worker--\u003e\u003ePM2: Exit (process.exit(0))\n            PM2-\u003e\u003eWorker: Restart\n        else Task Failure\n            Worker-\u003e\u003eBeads: bd create \u003cdependent-task\u003e\n            Worker-\u003e\u003eMCP: release_file_reservations()\n            Worker--\u003e\u003ePM2: Exit (process.exit(1))\n            PM2-\u003e\u003eWorker: Restart\n        end\n    else File Reservation Denied\n        Worker-\u003e\u003eWorker: Wait 5s\n        Worker-\u003e\u003eMCP: reserve_file_paths() [Retry 1]\n        \n        alt Still Denied\n            Worker-\u003e\u003eWorker: Wait 5s\n            Worker-\u003e\u003eMCP: reserve_file_paths() [Retry 2]\n            \n            alt Still Denied\n                Worker-\u003e\u003eWorker: Wait 5s\n                Worker-\u003e\u003eMCP: reserve_file_paths() [Retry 3]\n                \n                alt Still Denied After 3 Retries\n                    Worker--\u003e\u003ePM2: Exit (process.exit(1))\n                    PM2-\u003e\u003eWorker: Restart (claim different task)\n                end\n            end\n        end\n    end\n```\n\n## 6-Stage Iterative Workflow\n\n```mermaid\ngraph LR\n    subgraph Planning\n        A0[Stage 0: Discovery \u0026 Planning]\n        A0 --\u003e A1[Stage 1: Test Specification]\n    end\n    \n    subgraph Implementation\n        A1 --\u003e A2[Stage 2: Code Implementation]\n        A2 --\u003e A3[Stage 3: Static Analysis \u0026 Security]\n    end\n    \n    subgraph Validation\n        A3 --\u003e A4[Stage 4: Test Execution]\n        A4 --\u003e A5[Stage 5: Code Review]\n    end\n    \n    subgraph Deployment\n        A5 --\u003e A6[Stage 6: Deployment \u0026 Monitoring]\n    end\n    \n    A4 -.-\u003e|Failures| B1[Create Dependent Tasks]\n    A5 -.-\u003e|Review Comments| B2[Create Tasks by Type]\n    A6 -.-\u003e|Deployment Issues| B3[Create Rollback/Investigate Tasks]\n    \n    B1 -.-\u003e|Retry| A2\n    B2 -.-\u003e|Fix \u0026 Retry| A5\n    B3 -.-\u003e|Fix \u0026 Retry| A6\n    \n    style A0 fill:#e3f2fd\n    style A1 fill:#e3f2fd\n    style A2 fill:#bbdefb\n    style A3 fill:#ffcdd2\n    style A4 fill:#fff3cd\n    style A5 fill:#d4edda\n    style A6 fill:#d1ecf1\n    style B1 fill:#f8d7da\n    style B2 fill:#f8d7da\n    style B3 fill:#f8d7da\n```\n\n## Failure Handling \u0026 Task Creation\n\n```mermaid\ngraph TD\n    A[Stage Failure] --\u003e B{Parse Failure Type}\n    \n    B --\u003e|Test Failures| C1[Extract Failing Tests]\n    C1 --\u003e C2{Classify by Severity}\n    C2 --\u003e|Security/Core| C3[P0 Task]\n    C2 --\u003e|Integration/E2E| C4[P1 Task]\n    C2 --\u003e|Unit Edge Case| C5[P2 Task]\n    C2 --\u003e|Performance| C6[P3 Task]\n    \n    B --\u003e|Review Comments| D1[Extract Comments]\n    D1 --\u003e D2{Classify by Type}\n    D2 --\u003e|Security| D3[P0: Fix Security Issues]\n    D2 --\u003e|Bug| D4[P0: Fix Review Bugs]\n    D2 --\u003e|Architecture| D5[P1: Refactor Architecture]\n    D2 --\u003e|Performance| D6[P1: Optimize Performance]\n    D2 --\u003e|Accessibility| D7[P1: Fix Accessibility]\n    D2 --\u003e|Documentation| D8[P2: Add Documentation]\n    D2 --\u003e|Style| D9[P3: Address Style]\n    \n    B --\u003e|Deployment Issues| E1[Monitor Events]\n    E1 --\u003e E2{Issue Type}\n    E2 --\u003e|Deployment Failed| E3[P0: Rollback]\n    E3 --\u003e E4[P0: Investigate]\n    E2 --\u003e|Smoke Test Failed| E5[P0: Fix Smoke Tests]\n    E2 --\u003e|Health Check Failed| E6[P0: Fix Health Issues]\n    \n    C3 --\u003e F[Create Task in Beads]\n    C4 --\u003e F\n    C5 --\u003e F\n    C6 --\u003e F\n    D3 --\u003e F\n    D4 --\u003e F\n    D5 --\u003e F\n    D6 --\u003e F\n    D7 --\u003e F\n    D8 --\u003e F\n    D9 --\u003e F\n    E3 --\u003e F\n    E4 --\u003e F\n    E5 --\u003e F\n    E6 --\u003e F\n    \n    F --\u003e G[Link to Original Stage]\n    G --\u003e H{Retry Limit Reached?}\n    \n    H --\u003e|No| I[Retry with Backoff]\n    I --\u003e|Retry 1| J[Immediate]\n    I --\u003e|Retry 2| K[5 min wait]\n    I --\u003e|Retry 3| L[15 min wait]\n    \n    J --\u003e M[Re-run Stage]\n    K --\u003e M\n    L --\u003e M\n    \n    H --\u003e|Yes| N[Alert Developer]\n    N --\u003e O[Create Manual Intervention Task]\n    O --\u003e P[Stop Auto-queuing]\n    \n    style A fill:#f8d7da\n    style F fill:#fff3cd\n    style M fill:#d4edda\n    style P fill:#ffeaa7\n```\n\n## Cass Memory Learning Loop\n\n```mermaid\ngraph TD\n    A[Task Execution] --\u003e B[Record Metrics]\n    B --\u003e C{Success or Failure?}\n    \n    C --\u003e|Success| D[Extract Success Patterns]\n    C --\u003e|Failure| E[Extract Failure Patterns]\n    \n    D --\u003e F[Analyze: Agent Type, Task Type, Duration]\n    F --\u003e G[Calculate: Success Rate, Avg Time]\n    G --\u003e H[Store in cass_memory: success_patterns]\n    \n    E --\u003e I[Analyze: Stage, Failure Type, Error]\n    I --\u003e J[Calculate: Occurrence Count, Resolution Rate, Avg Time]\n    J --\u003e K[Identify: Root Cause, Recommended Action]\n    K --\u003e L[Store in cass_memory: failure_patterns]\n    \n    H --\u003e M[New Task Starts]\n    L --\u003e M\n    \n    M --\u003e N[Query cass_context]\n    N --\u003e O[Get: Relevant Rules, Anti-Patterns, History Snippets]\n    O --\u003e P[Include in Agent Prompt]\n    P --\u003e A\n    \n    style H fill:#d4edda\n    style L fill:#f8d7da\n    style O fill:#d1ecf1\n```\n\n## PM2 Worker Management\n\n```mermaid\ngraph LR\n    A[Developer] --\u003e|pm2 start| B[PM2 Daemon]\n    B --\u003e C[Worker Instance 1]\n    B --\u003e D[Worker Instance 2]\n    B --\u003e E[Worker Instance 3]\n    B --\u003e F[Worker Instance 4]\n    \n    C --\u003e G[Claim Task 1]\n    D --\u003e H[Claim Task 2]\n    E --\u003e I[Claim Task 3]\n    F --\u003e J[Claim Task 4]\n    \n    G --\u003e K[Execute \u0026 Exit]\n    H --\u003e K\n    I --\u003e K\n    K --\u003e L[PM2 Auto-restart]\n    \n    L --\u003e M[Claim Next Available Task]\n    M --\u003e N[Beads: bd ready]\n    N --\u003e O[MCP: reserve_file_paths]\n    O --\u003e P[opencode-task]\n    P --\u003e Q[Beads: bd close]\n    Q --\u003e K\n    \n    A -.-\u003e|pm2 scale 8| B\n    A -.-\u003e|pm2 stop all| B\n    A -.-\u003e|pm2 restart all| B\n    A -.-\u003e|pm2 logs| B\n    \n    style B fill:#e1f5ff\n    style K fill:#fff3cd\n```\n\n## Pre-commit Hook Flow\n\n```mermaid\ngraph TD\n    A[Developer: git commit] --\u003e B[Husky: pre-commit hook]\n    B --\u003e C[Lint-staged: Get staged files]\n    C --\u003e D{File Extension?}\n    \n    D --\u003e|*.js,*.ts| E[Run ESLint --fix]\n    E --\u003e F[Run Prettier --write]\n    F --\u003e G[Run TypeScript: tsc --noEmit]\n    G --\u003e H[git add]\n    \n    D --\u003e|*.py| I[Run Black]\n    I --\u003e J[Run Pylint]\n    J --\u003e K[Run MyPy]\n    K --\u003e H\n    \n    H --\u003e L{All Checks Pass?}\n    L --\u003e|Yes| M[Commit Allowed]\n    L --\u003e|No| N[Commit Blocked]\n    N --\u003e O[Show Errors/Warnings]\n    O --\u003e P[Developer Fixes Issues]\n    P --\u003e A\n    \n    style B fill:#ffcdd2\n    style L fill:#f8d7da\n    style M fill:#d4edda\n```\n\n## Success Criteria Flow\n\n```mermaid\ngraph TD\n    A[Task Complete] --\u003e B{Stage 0-6 Passed?}\n    \n    B --\u003e|No| C[Create Dependent Task]\n    C --\u003e D[Set Priority: P0-P4]\n    D --\u003e E[Link to Original Stage]\n    E --\u003e F[Exit Worker]\n    \n    B --\u003e|Yes| G{Quality Gates Passed?}\n    \n    G --\u003e|No| C\n    \n    G --\u003e|Yes| H[Close Task in Beads]\n    H --\u003e I[Release File Reservations]\n    I --\u003e J[Exit Worker]\n    J --\u003e K[PM2 Restarts]\n    K --\u003e L[Claim Next Task]\n    \n    L --\u003e M[ cass_memory: Learn from success/failure]\n    M --\u003e N[Metrics: Record duration, success, retries]\n    N --\u003e O[Next Stage or Feature]\n    \n    style C fill:#f8d7da\n    style H fill:#d4edda\n    style M fill:#d1ecf1\n    style N fill:#fff3cd\n```\n\n## Local to Production Rollout\n\n```mermaid\ngraph LR\n    subgraph Phase 1: Local Development\n        A1[Install Code Quality Tools]\n        A1 --\u003e A2[Install PM2]\n        A2 --\u003e A3[Implement Worker]\n        A3 --\u003e A4[Test Locally]\n    end\n    \n    subgraph Phase 2: Staging\n        B1[Deploy to Test Environment]\n        B1 --\u003e B2[Run Integration Tests]\n        B2 --\u003e B3[Validate with Multiple Workers]\n    end\n    \n    subgraph Phase 3: Production\n        C1[Deploy PM2 Config]\n        C1 --\u003e C2[Start Worker Pool]\n        C2 --\u003e C3[Monitor Performance]\n        C3 --\u003e C4[Scale as Needed]\n    end\n    \n    A4 --\u003e B1\n    B3 --\u003e C1\n    \n    style A4 fill:#d4edda\n    style B3 fill:#fff3cd\n    style C4 fill:#e1f5ff\n```\n\n## Metrics Collection Flow\n\n```mermaid\ngraph TD\n    A[Task Event] --\u003e B[Metrics Agent]\n    \n    B --\u003e C{Event Type}\n    \n    C --\u003e|Task Completion| D[Record: Duration, Stage, Success]\n    C --\u003e|Stage Failure| E[Record: Stage, Failure Type, Error]\n    C --\u003e|AI Assistance| F[Record: Agent Type, Task ID, Duration]\n    \n    D --\u003e G[Send to Metrics Backend]\n    E --\u003e G\n    F --\u003e G\n    \n    G --\u003e H[Prometheus: Store Metrics]\n    H --\u003e I[Grafana: Display Dashboards]\n    I --\u003e J[Alert: PagerDuty/Slack]\n    \n    G --\u003e K[ cass_memory: Learn Patterns]\n    K --\u003e L[Failure Patterns]\n    K --\u003e M[Success Patterns]\n    \n    L --\u003e N[Generate Recommendations]\n    M --\u003e N\n    N --\u003e O[Apply to Future Tasks]\n    \n    style H fill:#e1f5ff\n    style I fill:#e1f5ff\n    style J fill:#f8d7da\n    style K fill:#d1ecf1\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T13:09:47.170709+05:30","created_by":"buddhi","updated_at":"2026-01-08T13:43:50.311386+05:30","closed_at":"2026-01-08T13:43:50.311386+05:30","close_reason":"Already completed - visual guides in docs/TASK_IMPLEMENTATION_PROCESS_VISUAL.md"}
{"id":"opencode-44n","title":"Implement new specialist agents (test-specialist, code-reviewer, deployment-specialist)","description":"Create 3 new specialist agents for automated test generation, code review, and deployment automation","design":"## New Specialist Agents to Implement\n\n### 1. test-specialist Agent\n**Purpose:** Generate test specifications and test code for acceptance criteria\n\n**Capabilities:**\n- Generate comprehensive test specifications (unit, integration, E2E)\n- Write test code (pytest, jest, playwright, cypress)\n- Create test fixtures and mocks\n- Ensure test coverage ≥ 80%\n- Optimize test performance\n\n**Input:**\n- Feature requirements\n- Figma designs (if applicable)\n- Acceptance criteria\n- Existing codebase\n\n**Output:**\n- `test-specification.md` - Detailed test plan\n- `tests/unit/*.test.js` - Unit test files\n- `tests/integration/*.test.js` - Integration test files\n- `tests/e2e/*.test.js` - E2E test files (Playwright/Cypress)\n- `tests/fixtures/*.js` - Test fixtures\n- `tests/mocks/*.js` - Test mocks\n- `package.json` - Updated with test scripts\n\n**Stage:** Stage 1 (Test Specification \u0026 Generation)\n\n### 2. code-reviewer Agent\n**Purpose:** Comprehensive code review with automated checks\n\n**Capabilities:**\n- Parse review comments from PRs\n- Classify comments by type (bug, style, architecture, performance, security, documentation, accessibility)\n- Create tasks for each comment category\n- Enforce automated review checks (PR size, TODO/FIXME, debug statements, documentation)\n- Assess performance implications\n- Verify security implications\n- Check accessibility compliance\n\n**Input:**\n- PR diff\n- Review comments (from GitHub/GitLab API)\n- Code quality reports\n\n**Output:**\n- `code-review-report.json` - Automated review results\n- `performance-assessment.json` - Performance impact analysis\n- `security-assessment.json` - Security implications\n- `accessibility-report.json` - A11y compliance\n- `documentation-checklist.json` - Documentation verification\n- Beads tasks for review comments (if any)\n\n**Stage:** Stage 5 (Code Review \u0026 Validation)\n\n**Task Creation Patterns:**\n- security → \"Fix Security Issues\" (P0)\n- bug → \"Fix Review Bugs\" (P0)\n- architecture → \"Refactor Architecture Issues\" (P1)\n- performance → \"Optimize Performance Issues\" (P1)\n- accessibility → \"Fix Accessibility Issues\" (P1)\n- documentation → \"Add Missing Documentation\" (P2)\n- style → \"Address Style Comments\" (P3)\n\n### 3. deployment-specialist Agent\n**Purpose:** Deployment automation and monitoring\n\n**Capabilities:**\n- Deploy to staging/production\n- Run smoke tests\n- Check health endpoints\n- Configure monitoring and logging\n- Set up error tracking (Sentry)\n- Create rollback plans\n- Monitor for deployment failures\n\n**Input:**\n- CI/CD pipeline status\n- Deployment configuration\n- Health check endpoints\n\n**Output:**\n- `deployment-report.json` - Deployment results\n- `health-check-report.json` - Service health status\n- `monitoring-config.json` - Monitoring configuration\n- `rollback-plan.md` - Rollback procedures\n- Beads tasks for deployment failures (if any)\n\n**Stage:** Stage 6 (Deployment \u0026 Monitoring)\n\n**Failure Handling:**\n- P0 \"Rollback failed deployment\" (immediate)\n- P0 \"Investigate deployment failure\" (after rollback)\n- P0 \"Fix failing smoke tests\"\n- P0 \"Fix service health issues\"\n\n## Existing Agents (Already Installed)\n\n### Primary Agents (Tab Completion)\n1. **orchestrator** - Master coordinator with dual-mode operation (COORDINATION vs DIRECT)\n2. **prd** - Product Requirements Document generator with stakeholder alignment\n3. **generate-tasks** - Atomic task breakdown with dependencies\n4. **task-coordinator** - Beads task creation and tracking\n\n### Internal Research Droids (9 agents)\n1. **codebase-researcher** - Pattern discovery and technical debt identification\n2. **git-history-analyzer** - Change evolution and team collaboration analysis\n3. **context-researcher** - Project-wide context gathering (stakeholder analysis)\n4. **best-practices-researcher** - Industry best practices and competitive analysis\n5. **library-source-reader** - Third-party library deep analysis\n6. **domain-specialist** - Domain-specific expertise and compliance\n7. **semantic-search** (osgrep) - Conceptual code search with embedding models\n8. **file-picker-agent** - Targeted file discovery and codebase navigation\n9. **figma-design-extractor** - Figma design token extraction for pixel-perfect implementation\n\n### Skills (3 skills)\n- **task-breakdown** - Feature → tasks workflow\n- **feature-planning** - End-to-end PRD generation\n- **complex-project** - Enterprise feature planning\n\n## Existing Tools \u0026 Infrastructure\n\n### Task Tracking (Beads)\n**Status:** ✅ Ready\n**Commands:**\n- `bd ready` - Find available work (unblocked)\n- `bd show \u003cid\u003e` - View issue details\n- `bd update \u003cid\u003e --status in_progress` - Claim work\n- `bd close \u003cid\u003e` - Complete work\n- `bd sync` - Commit and push changes\n- `bd create` - Create new task\n\n**Features:**\n- Dependency-aware task tracking\n- Graph analytics (PageRank, critical path, cycles)\n- Time-travel (compare project state across revisions)\n- Bead-to-commit correlations\n- Git-native persistence (.beads/ directory)\n\n### Agent Coordination (MCP Agent Mail)\n**Status:** ✅ Ready\n**Client:** `~/.config/opencode/mcp_agent_mail_client.py`\n\n**Available Functions:**\n- `reserve_file_paths(agent_name, paths, ttl_seconds)` - Reserve files before editing\n- `release_file_reservations(agent_name)` - Release files after completion\n\n**Features:**\n- HTTP API for agent communication\n- Message formats: task_assignment, task_completion, error_report, status_update\n- File reservations prevent conflicts\n- TTL-based auto-release (if worker crashes)\n- Agent registration tracking\n\n### Memory System (cass_memory)\n**Status:** ✅ Ready\n**Command:** `cm context \"\u003ctask\u003e\" --json`\n\n**Returns:**\n- `relevantBullets` - Evidence-backed rules\n- `antiPatterns` - Pitfalls to avoid\n- `historySnippets` - Similar past sessions\n- `suggestedCassQueries` - Deeper investigation searches\n\n**Features:**\n- Evidence validation (rules require historical proof)\n- Confidence decay (90-day half-life prevents stale patterns)\n- Anti-pattern learning (bad rules auto-convert to warnings)\n- Trauma guard (blocks dangerous commands)\n- Cross-agent learning\n\n### Process Management (PM2)\n**Status:** ❌ Not installed (needs npm install -g pm2)\n**Purpose:** Process lifecycle, restarts, scaling, resource limits\n\n### CI/CD Pipeline\n**Status:** ❌ Not implemented\n**Needs:** GitHub Actions workflow for stages 3-6\n\n### Testing Frameworks\n**Status:** ⚠️ Partial (17 test scripts exist but no runner)\n**Needs:** pytest/jest integration, coverage reporting\n\n### Code Quality Tools\n**Status:** ❌ Not implemented\n**Needs:** ESLint, Prettier, Black, pylint, Snyk\n\n### Monitoring \u0026 Logging\n**Status:** ❌ Not implemented\n**Needs:** Prometheus, Grafana, Sentry, PagerDuty, ELK Stack\n\n### Deployment Infrastructure\n**Status:** ❌ Not implemented\n**Needs:** Staging environment, deployment scripts, health check endpoints","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T12:20:33.817334+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:45:48.821758+05:30","closed_at":"2026-01-08T15:45:48.821758+05:30","close_reason":"Completed - Implemented 3 specialist agents following atomic task cycle pattern: test-specialist (Stage 1 \u0026 3), code-reviewer (Stage 5), deployment-specialist (Stage 6). Each agent includes success/failure handling, quality gates, and Beads/MCP/cass_memory integration."}
{"id":"opencode-4wm","title":"Create opencode MCP Agent Mail client helper","description":"Create ~/.config/opencode/mcp_agent_mail_client.py - HTTP-based client for opencode agents to communicate with MCP Agent Mail. Adapted from Factory's mcp_agent_mail_client.py but using requests instead of MCP client. Functions: register_agent, send_message, fetch_inbox, acknowledge_message, reserve_file_paths, release_file_reservations.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.386134+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Created ~/.config/opencode/mcp_agent_mail_client.py - HTTP-based client for opencode agents to communicate with MCP Agent Mail. Includes functions: register_agent, send_message, fetch_inbox, acknowledge_message, reserve_file_paths, release_file_reservations, get_project_key. Tested import and get_project_key() function.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-52k","title":"Implement headless worker script","description":"Create 30-line stateless headless worker that claims Beads tasks, reserves files via MCP, executes via opencode, and exits for PM2 restart","design":"## Headless Worker Implementation\n\n### File Location\n~/.config/opencode/bin/headless-worker.js\n\n### Worker Lifecycle (Simple 30-line stateless script)\n```javascript\n#!/usr/bin/env node\n\nconst { execSync } = require('child_process');\n\nfunction run(cmd) {\n  try {\n    return execSync(cmd, { encoding: 'utf8' }).trim();\n  } catch (error) {\n    console.error(`Command failed: ${cmd}`);\n    throw error;\n  }\n}\n\n// 1. Poll Beads for available tasks\nconst readyOutput = run('bd ready');\nif (!readyOutput || readyOutput.includes('No ready work')) {\n  console.log('No tasks available, sleeping 5s then exiting');\n  setTimeout(() =\u003e process.exit(0), 5000);\n  return;\n}\n\n// 2. Extract task_id from output\nconst taskId = readyOutput.split(' ')[0];\nconsole.log(`Claimed task: ${taskId}`);\n\n// 3. Reserve file paths via MCP\ntry {\n  run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n} catch (error) {\n  console.log('File reservation denied, retrying...');\n  // Retry logic up to 3x\n  for (let i = 0; i \u003c 3; i++) {\n    try {\n      setTimeout(() =\u003e {}, 5000);\n      run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n      break;\n    } catch (retryError) {\n      if (i === 2) {\n        console.log('Reservation failed after 3 retries, exiting');\n        process.exit(1);\n      }\n    }\n  }\n}\n\n// 4. Execute task using opencode\ntry {\n  run(`opencode-task ${taskId}`);\n  \n  // 5. On success - complete task\n  run(`bd close ${taskId} --reason=\"Completed\"`);\n  console.log(`Task ${taskId} completed successfully`);\n} catch (error) {\n  // 6. On failure - create dependent task (if applicable)\n  console.error(`Task ${taskId} failed: ${error.message}`);\n  // Dependent task creation happens in CI/CD or review stage\n}\n\n// 7. Release file reservations via MCP\nrun(`python3 -c \"from mcp_agent_mail_client import release_file_reservations; import asyncio; asyncio.run(release_file_reservations(agent_name='headless-worker'))\"}`);\n\n// 8. Exit -\u003e PM2 restarts -\u003e claims next task\nprocess.exit(0);\n```\n\n### Key Features\n- **Stateless**: Worker exits after each task, PM2 restarts\n- **File Reservations**: Uses existing MCP Agent Mail functions\n- **No Custom Endpoints**: Leverages existing infrastructure\n- **Error Handling**: Retry logic for file reservations\n- **Exit on Completion**: PM2 auto-restarts for next task\n\n### Required Components\n- Beads task claiming (bd ready, bd show, bd close)\n- MCP file reservations (reserve_file_paths, release_file_reservations)\n- Task execution via opencode (opencode-task \u003ctask-id\u003e)\n- Exit on completion (PM2 auto-restarts)\n- Error handling -\u003e dependent task creation\n\n### File Reservation Flow\n```bash\n# Before task execution\npython3 -c \"\nfrom mcp_agent_mail_client import reserve_file_paths\nimport asyncio\nasyncio.run(reserve_file_paths(\n    agent_name='headless-worker',\n    paths=['src/**/*', 'tests/**/*'],\n    ttl_seconds=3600\n))\n\"\n\n# After task completion\npython3 -c \"\nfrom mcp_agent_mail_client import release_file_reservations\nimport asyncio\nasyncio.run(release_file_reservations(agent_name='headless-worker'))\n\"\n```\n\n### MCP Agent Mail Integration\n**What MCP Agent Mail Already Handles:**\n- File path reservations (prevents concurrent edits)\n- TTL-based auto-release (if worker crashes)\n- Agent registration tracking\n- Message passing for coordination\n- Lock conflict resolution (grants first, denies second)\n\n**No Custom Endpoints Needed!**\n\n### Edge Cases\n1. **Worker crashes**: PM2 auto-restarts, MCP detects no heartbeat and auto-releases task lock after 5min\n2. **No tasks available**: Worker sleeps 5s, exits, PM2 restarts\n3. **File reservation denied**: Retry 3x with 5s delay, exit if still denied\n4. **Task execution failure**: Create dependent task, release reservations, exit\n5. **Network partition**: MCP server heartbeat timeout triggers lock auto-release, tasks re-claimable on reconnect\n6. **All tasks fail repeatedly**: PM2 restart limit (10x) reached, instance stops claiming new tasks, alerts developer\n7. **Machine runs out of RAM**: PM2 max_memory_restart threshold triggers worker restart\n8. **Two workers claim same task simultaneously**: MCP grants lock to first requester, denies second (worker exits, claims different task)\n9. **Worker stuck in infinite loop**: MCP detects no heartbeat, auto-releases lock after timeout, another worker reclaims task\n\n### Success Criteria\n- Worker can poll Beads for tasks\n- Worker can reserve files via MCP\n- Worker can execute opencode tasks\n- Worker completes and exits (PM2 restarts)\n- File reservations prevent git conflicts\n- Failed tasks create dependent tasks automatically","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T12:19:32.682371+05:30","created_by":"buddhi","updated_at":"2026-01-08T13:43:50.255215+05:30","closed_at":"2026-01-08T13:43:50.255215+05:30","close_reason":"Duplicate of opencode-vvz - headless worker script"}
{"id":"opencode-5sk","title":"Migrate Factory Continuous Learning System to cass_memory playbook","description":"Extract high-value patterns from Factory CLS (codebase_intelligence.json, git_patterns.json, library_insights.json, learning_metrics.json, success_patterns.json, failure_patterns.json, project_templates.json) and convert to cass_memory playbook rules. Create starter playbook at ~/.config/opencode/.beads/starters/factory-legacy.yaml. Validate rules with evidence and migrate unique aggregate metrics (technology usage, project templates) as supplementary content.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:57.34149+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Created factory-legacy.yaml starter playbook at .beads/starters/ with 979 lines of evidence-based patterns migrated from Factory CLS. Includes success patterns, anti-patterns, task granularity rules, full-stack templates, and quality gates with historical metrics from 50+ projects","dependencies":[{"issue_id":"opencode-5sk","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:56:57.342438+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-67n","title":"Update AGENTS.md with prompt caching documentation","description":"Add prompt caching section to AGENTS.md documenting GPTCache integration, cache configuration, and usage guidelines for reducing LLM costs and improving response times.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T12:32:18.368024+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Added comprehensive GPTCache documentation to AGENTS.md with setup, configuration, cache behavior, control commands, and benefits. Updated session-start.sh to check GPTCache. Added GPTCache installation to opencode-init (Step 8) with Python 3.10+ check and automatic server start.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-6f1","title":"Install PM2 and create ecosystem configuration","description":"Install PM2 globally and create ecosystem.config.js for local development and testing","design":"## Install PM2 and Configure Ecosystem\n\n### Purpose\nInstall PM2 globally and create ecosystem configuration for headless swarm workers\n\n### Installation\n```bash\n# Install PM2 globally\nnpm install -g pm2\n\n# Verify installation\npm2 --version\n```\n\n### Create Ecosystem Configuration\n**File:** `~/.config/opencode/ecosystem.config.js`\n\n```javascript\nmodule.exports = {\n  apps: [{\n    name: 'headless-swarm',\n    script: './bin/headless-worker.js',\n    instances: 4,  // 4 parallel workers (configurable)\n    autorestart: true,\n    max_restarts: 10,\n    max_memory_restart: '1G',\n    error_file: '~/.config/opencode/logs/err.log',\n    out_file: '~/.config/opencode/logs/out.log',\n    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    merge_logs: true,\n    kill_timeout: 5000\n  }]\n};\n```\n\n### Create Log Directory\n```bash\nmkdir -p ~/.config/opencode/logs\n```\n\n### Create Bin Directory\n```bash\nmkdir -p ~/.config/opencode/bin\n```\n\n### PM2 Commands (No Custom CLI Needed)\n```bash\n# Start workers\npm2 start ecosystem.config.js\n\n# Scale to different worker count\npm2 scale headless-swarm 8    # 8 workers\npm2 scale headless-swarm 2    # 2 workers\n\n# Check status\npm2 list                 # Show all workers and their status\npm2 monit                 # Real-time dashboard\n\n# View logs\npm2 logs                  # Live logs\npm2 logs --lines 100      # Last 100 lines\n\n# Control workers\npm2 stop all              # Stop all workers\npm2 restart all           # Restart all workers\npm2 delete all            # Remove all from PM2\n\n# Save PM2 configuration (auto-start on system boot)\npm2 save\npm2 startup               # Generate startup script\n```\n\n### Key Settings\n- **instances**: 4 parallel workers (scale with: pm2 scale headless-swarm 8)\n- **max_memory_restart**: Restart worker if \u003e1GB RAM\n- **max_restarts**: Auto-restart up to 10 times\n- **merge_logs**: Combine all worker logs\n- **autorestart**: PM2 auto-restarts crashed workers\n\n### Integration Points\n- Headless worker script: `./bin/headless-worker.js`\n- Beads CLI: bd ready, bd show, bd close\n- MCP Agent Mail: reserve_file_paths, release_file_reservations\n- opencode execution: opencode-task \u003ctask-id\u003e\n\n### Success Criteria\n- PM2 installed globally\n- ecosystem.config.js created\n- Log directory created\n- Bin directory created\n- PM2 commands working\n- PM2 can start/stop/restart workers\n- PM2 can scale workers up/down\n- PM2 logs accessible","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:47:12.859998+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.514634+05:30"}
{"id":"opencode-6n7","title":"Migrate MCP Agent Mail integration to opencode","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.15804+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: MCP Agent Mail client and MESSAGE_FORMATS migrated","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-7fm","title":"Test opencode-init and workspace-init scripts","description":"Test both scripts to ensure they work correctly: opencode-init installs tools and configures PATH, workspace-init initializes cass_memory and beads for projects.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T19:37:39.946689+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Both scripts tested successfully. opencode-init detects tools and offers PATH configuration. workspace-init shows help correctly. Scripts are ready for use.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-7rh","title":"Migrate Factory skills to opencode (task-breakdown, feature-planning, complex-project)","description":"Copy Factory skills (task-breakdown, feature-planning, complex-project) from ~/.factory/skills/ to ~/.config/opencode/skills/. Update references to use cass_memory for context before generating tasks. Ensure skills work with bd task creation and cass_memory context queries.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T11:57:25.543582+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"All 3 skills migrated from Factory droids: complex-project, feature-planning, task-breakdown","dependencies":[{"issue_id":"opencode-7rh","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:57:25.54465+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-7u8","title":"Convert generate-tasks.md - remove Factory dependencies","description":"Remove MCP Agent Mail registration code and session initialization blocks from agent/generate-tasks.md. Keep task atomicity validation, multi-level hierarchy, parallel execution tracks, and Senior Engineer Framework intelligence gathering.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.007528+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Removed MCP Agent Mail Integration section (lines 65-134) and Implementation Note (lines 417-449). Kept task atomicity validation, multi-level hierarchy, parallel execution tracks, and Senior Engineer Framework intelligence gathering.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-8eu","title":"Create workspace-init script","description":"Create ~/.config/opencode/bin/workspace-init script that initializes git repo (if missing), runs cm init --repo (REQUIRED), and initializes beads (bd init). Optional osgrep models download. Replaces Factory's workspace-init for opencode.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T19:37:39.946822+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Created ~/.config/opencode/bin/workspace-init script with git init, cm init --repo (REQUIRED), and bd init","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-8tx","title":"Design quality gates and integration points","description":"Design CI/CD quality gates, pre-commit hooks, and Beads integration","design":"## Quality Gates Design\n\n### CI/CD Pipeline Gates (Stage 3, 4, 5, 6)\n**Stage 3: Static Analysis \u0026 Security**\n- Linting: ESLint, Prettier, Black, pylint\n- Security: Snyk, OWASP ZAP, npm audit, pip-audit\n- Complexity: Cyclomatic complexity ≤ 10\n- Duplicates: ≤ 3% duplication\n- Dependencies: No vulnerable dependencies\n\n**Stage 4: Test Execution**\n- Unit tests: 100% pass rate\n- Integration tests: 100% pass rate\n- E2E tests: 100% pass rate\n- Coverage: ≥ 80%\n- Flaky tests: ≤ 1% rate\n- Performance: No regression\n\n**Stage 5: Code Review**\n- PR size: ≤ 400 lines\n- TODO/FIXME: 0 comments\n- Debug statements: 0 console.log/debugger\n- Documentation: All functions documented\n- Migration guide: Required for breaking changes\n\n**Stage 6: Deployment**\n- Staging: Successful deployment\n- Smoke tests: All pass\n- Health checks: All pass\n- Monitoring: Configured\n- Error tracking: Configured (Sentry)\n- Rollback: Plan tested\n\n### Pre-commit Hooks (Husky + lint-staged)\n**Before commit:**\n- JS/TS: eslint --fix, prettier --write, tsc --noEmit\n- Python: black, pylint, mypy\n\n### Beads Integration\nEach task has:\n- stage field (0-6)\n- quality_gates array with check commands\n- on_failure task creation config\n- max_retries setting\n- retry_backoff array","notes":"See parent epic: opencode-lsl","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T11:51:56.197709+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.836158+05:30","dependencies":[{"issue_id":"opencode-8tx","depends_on_id":"opencode-h2t","type":"blocks","created_at":"2026-01-08T11:52:58.382496+05:30","created_by":"buddhi"},{"issue_id":"opencode-8tx","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.141076+05:30","created_by":"buddhi"}]}
{"id":"opencode-908","title":"Create opencode-init script","description":"Create ~/.config/opencode/bin/opencode-init script that installs cass_memory (cm), beads CLI (bd), beads viewer (bv), and osgrep if missing. Adds ~/.config/opencode/bin to PATH automatically. Replaces Factory's droid-init for opencode.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T19:37:39.947307+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Created ~/.config/opencode/bin/opencode-init script with installation for cm, bd, bv, osgrep and PATH configuration","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-9bz","title":"Migrate droids from Factory CLI to opencode agent/","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.160759+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: All droids migrated and path references updated","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-9zc","title":"Convert research droids - remove Factory dependencies","description":"Remove MCP Agent Mail registration code from 9 research droids: codebase-researcher, context-researcher, git-history-analyzer, library-source-reader, domain-specialist, best-practices-researcher, file-picker-agent, semantic-search, figma-design-extractor. Keep core research capabilities and methodology.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T18:43:01.006775+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Duplicate task, replaced by opencode-wva","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-bw7","title":"Set up local code quality tools","description":"Design and implement dynamic code quality tool installation based on project source code languages detected. Should be project-level infrastructure that auto-detects and installs appropriate tools (ESLint, Prettier, Black, etc.) based on codebase composition.","design":"## Local Code Quality Tools\n\n### Tools to Install\n**JavaScript/TypeScript:**\n- ESLint - Code linting\n- Prettier - Code formatting\n- TypeScript - Type checking\n\n**Python:**\n- Black - Code formatting\n- Pylint - Code linting\n- MyPy - Type checking\n\n### Pre-commit Hooks (Husky + lint-staged)\n```json\n// package.json\n{\n  \"husky\": {\n    \"hooks\": {\n      \"pre-commit\": \"lint-staged\"\n    }\n  },\n  \"lint-staged\": {\n    \"*.js\": [\n      \"eslint --fix\",\n      \"prettier --write\",\n      \"git add\"\n    ],\n    \"*.ts\": [\n      \"eslint --fix\",\n      \"prettier --write\",\n      \"tsc --noEmit\",\n      \"git add\"\n    ],\n    \"*.py\": [\n      \"black\",\n      \"pylint\",\n      \"mypy\",\n      \"git add\"\n    ]\n  }\n}\n```\n\n### Installation Commands\n```bash\n# JavaScript/TypeScript\nnpm install --save-dev eslint prettier typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin husky lint-staged\n\n# Python\npip install black pylint mypy\n\n# Initialize Husky\nnpx husky install\nnpx husky add .husky/pre-commit \"npx lint-staged\"\n```\n\n### ESLint Configuration (.eslintrc.js)\n```javascript\nmodule.exports = {\n  env: {\n    node: true,\n    es2021: true\n  },\n  extends: [\n    'eslint:recommended'\n  ],\n  parserOptions: {\n    ecmaVersion: 'latest',\n    sourceType: 'module'\n  },\n  rules: {\n    'no-console': 'warn',\n    'no-unused-vars': 'error',\n    'prefer-const': 'error'\n  }\n};\n```\n\n### Prettier Configuration (.prettierrc)\n```json\n{\n  \"semi\": true,\n  \"trailingComma\": \"es5\",\n  \"singleQuote\": true,\n  \"printWidth\": 100,\n  \"tabWidth\": 2\n}\n```\n\n### Benefits\n- Catches errors before commit\n- Consistent code formatting\n- Type safety enforced\n- No broken code pushed to repo\n\n### Success Criteria\n- All linters installed and configured\n- Pre-commit hooks working\n- Auto-formatting on commit\n- Type checking on commit\n- No warnings/errors on clean code","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:46:09.353871+05:30","created_by":"buddhi","updated_at":"2026-01-08T14:47:56.098319+05:30"}
{"id":"opencode-cbl","title":"Implement atomic task cycle in orchestrator","description":"Modify PRD and generate-tasks to implement 6-stage workflow with Beads dependency graph handling: PRD generator adds workflow spec, generate-tasks creates 5 dependent tasks per feature (plan → write-tests → implement → test → quality-checks). Individual agents handle success (close task) vs failure (create dependent fix task, then close). Orchestrator just spawns agents for ready tasks from Beads. Test with orchestrator first before headless swarm.","design":"## Atomic Task Cycle Implementation\n\n### Overview\nImplement 6-stage iterative workflow using Beads dependency graph. Individual agents handle success/failure by closing tasks or creating dependent fix tasks. Orchestrator only spawns agents for ready tasks - no modification needed.\n\n### 6-Stage Workflow\n1. **Stage 0: Discovery \u0026 Planning** - PRD validation, risk assessment\n2. **Stage 1: Write Unit Tests** - Test specification and generation\n3. **Stage 2: Implement Code** - Feature implementation\n4. **Stage 3: Test Code** - Execute all tests\n5. **Stage 4: Quality Checks** - Static analysis, security, linting\n6. **Repeat** until all stages pass\n\n### Task Dependency Chain (Handled by Beads)\n```\nTask X-0: Plan (Stage 0)\nTask X-1: Write Unit Tests (Stage 1) [depends on X-0]\nTask X-2: Implement Code (Stage 2) [depends on X-1]\nTask X-3: Test Code (Stage 3) [depends on X-2]\nTask X-4: Quality Checks (Stage 4) [depends on X-3]\n\nIf X-4 fails:\n  Task X-5: Fix Quality Issues [depends on X-4]\n  Task X-3-retry: Re-run Test Code [depends on X-5]\n  Task X-4-retry: Re-run Quality Checks [depends on X-3-retry]\n```\n\n**Key Insight:** Beads automatically unlocks X-1 when X-0 closes, X-2 when X-1 closes, etc. No orchestration logic needed.\n\n### Agents to Modify\n\n#### 1. PRD Generator (prd)\n**Changes:**\n- Add 6-stage workflow specification\n- Add quality gate requirements per stage\n- Add dependency relationship rules\n- Add failure handling patterns\n\n**Output:** PRD includes workflow spec\n\n#### 2. generate-tasks\n**Changes:**\n- Create 5 tasks per feature (X-0 to X-4)\n- Set up dependencies: X-1 depends on X-0, X-2 depends on X-1, etc.\n- For each task, specify:\n  - Stage number (0-4)\n  - Quality gates to check\n  - On-failure task creation template\n- Acceptance criteria per stage\n\n**Output:** Beads tasks with correct dependencies\n\n#### 3. Individual Agents (test-specialist, implementation-agent, etc.)\n**Success Path:**\n1. Execute task\n2. Pass all quality gates\n3. `bd close \u003ctask-id\u003e --reason=\"Completed\"`\n4. Agent exits\n5. Beads unlocks next dependent task automatically\n\n**Failure Path:**\n1. Execute task\n2. Fail quality gate (e.g., test failures, lint errors)\n3. Create dependent fix task:\n   ```bash\n   bd create --title=\"Fix failing tests\" \\\n             --type=bug \\\n             --priority=0 \\\n             --depends_on=\u003ccurrent-task-id\u003e \\\n             --description=\"2 tests failing: test_login_fails, test_signup_validates_email\"\n   ```\n4. `bd close \u003ctask-id\u003e --reason=\"Failed - created dependent fix task\"`\n5. Agent exits\n6. Beads keeps dependent tasks blocked until fix task completes\n\n#### 4. Orchestrator\n**NO CHANGES NEEDED**\n\n**Current Behavior (Already Correct):**\n1. Run `bd ready` to find unblocked tasks\n2. Spawn appropriate agent for each ready task\n3. Wait for agent to complete\n4. Repeat\n\n**The dependency graph does all the work:**\n- Task X-0 closes → X-1 becomes ready → orchestrator spawns agent for X-1\n- Task X-1 closes → X-2 becomes ready → orchestrator spawns agent for X-2\n- Task X-2 fails → X-5 created (depends on X-2) → X-3 remains blocked until X-5 closes\n\n### Test Scenarios\n\n#### Test 1: Happy Path (All stages pass)\n1. Create feature task with PRD\n2. generate-tasks creates 5 dependent tasks (X-0 to X-4)\n3. Orchestrator spawns agent for X-0 (only ready task)\n4. Agent completes X-0 successfully → `bd close X-0`\n5. Beads unlocks X-1\n6. Orchestrator spawns agent for X-1\n7. Agent completes X-1 successfully → `bd close X-1`\n8. Beads unlocks X-2\n9. ...repeat for X-3, X-4\n10. All tasks closed → feature complete!\n\n**Expected:** No dependent tasks created, cass_memory learns success pattern\n\n#### Test 2: Test Failure (Stage 3 fails)\n1. X-0 completes → `bd close X-0` → X-1 unlocks\n2. X-1 completes → `bd close X-1` → X-2 unlocks\n3. X-2 completes → `bd close X-2` → X-3 unlocks\n4. Orchestrator spawns agent for X-3\n5. Agent runs tests → 2 tests failing\n6. Agent creates X-5: Fix Failing Tests (depends on X-3)\n7. Agent closes X-3: `bd close X-3 --reason=\"Tests failing - created X-5\"`\n8. Beads keeps X-4 blocked (X-3 is closed but X-4 depends on it, need re-run)\n9. Orchestrator spawns agent for X-5 (only ready task)\n10. X-5 completes → `bd close X-5` → X-3-retry (new task) unlocks\n11. X-3-retry completes → `bd close X-3-retry` → X-4 unlocks\n12. X-4 completes → `bd close X-4`\n13. Feature complete!\n\n**Expected:** 1 dependent task (X-5) + 1 re-run task (X-3-retry), cass_memory learns failure pattern\n\n#### Test 3: Quality Failure (Stage 4 fails)\n1. X-0, X-1, X-2, X-3 all complete successfully\n2. X-4 quality checks fail (ESLint errors)\n3. Agent creates X-5: Fix Lint Errors (depends on X-4)\n4. Agent closes X-4: `bd close X-4 --reason=\"Lint errors - created X-5\"`\n5. Orchestrator spawns agent for X-5\n6. X-5 completes → `bd close X-5` → X-4-retry unlocks\n7. X-4-retry completes → `bd close X-4-retry`\n8. Feature complete!\n\n**Expected:** 1 dependent task (X-5) + 1 re-run task (X-4-retry), cass_memory learns failure pattern\n\n### Success Criteria\n- PRD generator includes 6-stage workflow spec\n- generate-tasks creates 5 dependent tasks per feature\n- Individual agents handle success (close task) vs failure (create dependent fix task)\n- Orchestrator spawns agents for ready tasks (no changes needed)\n- Beads dependency graph handles task unlocking automatically\n- Success completes atomic task\n- Failures create dependent fix tasks automatically\n- cass_memory learns from successes and failures\n- Can test single atomic tasks with orchestrator (no headless swarm needed)\n\n### Estimated Time\n- Modify PRD generator: 2-3 hours\n- Modify generate-tasks: 3-4 hours\n- Modify individual agents (success/failure handling): 4-5 hours\n- Test scenarios: 2-3 hours\n- Total: 11-15 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T14:47:51.209765+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:25:34.100352+05:30","closed_at":"2026-01-08T15:25:34.100352+05:30","close_reason":"Completed - Updated PRD and generate-tasks agents with 6-stage atomic task cycle specification. Created agent success/failure pattern guide documenting how individual agents should handle success (close task) vs failure (create dependent fix task). Orchestrator requires no changes - Beads dependency graph handles task unlocking automatically."}
{"id":"opencode-g4a","title":"Document metrics collection and learning system","description":"Design metrics collection, Prometheus integration, and cass memory learning system","design":"## Metrics Collection \u0026 Learning System\n\n### Metrics to Track\n**Quality Metrics:**\n- Code coverage percentage\n- Defect escape rate (bugs in production)\n- Mean time to detection (MTTD)\n- Mean time to resolution (MTTR)\n- Technical debt ratio\n- Code churn (lines changed/week)\n\n**Velocity Metrics:**\n- Lead time (idea to production)\n- Cycle time (start to finish)\n- Throughput (tasks/week)\n- Task completion rate\n- Average task duration\n- Deployment frequency\n\n**Workflow Metrics:**\n- Test execution time\n- Pipeline success rate\n- Flaky test rate\n- Average PR size\n- Review turnaround time\n- Rollback frequency\n\n**AI Assistance Metrics:**\n- AI task completion rate\n- AI-generated code acceptance rate\n- Time saved by AI assistance\n- AI prompt success rate\n- Human intervention rate\n\n### Metrics Collection System\n**Prometheus Metrics Export:**\n```javascript\nconst client = require('prom-client');\n\n// Task completion duration histogram\nconst taskDuration = new client.Histogram({\n  name: 'opencode_task_duration_seconds',\n  help: 'Task completion duration in seconds',\n  labelNames: ['stage', 'success'],\n  buckets: [60, 300, 900, 1800, 3600]\n});\n\n// Stage failures counter\nconst stageFailures = new client.Counter({\n  name: 'opencode_stage_failures_total',\n  help: 'Total stage failures',\n  labelNames: ['stage', 'failure_type']\n});\n\n// AI assistance success rate gauge\nconst aiSuccessRate = new client.Gauge({\n  name: 'opencode_ai_success_rate',\n  help: 'AI task success rate',\n  labelNames: ['agent_type']\n});\n```\n\n### Cassandra (cass_memory) Learning\n**Failure Pattern Learning:**\n```javascript\nconst learning = {\n  extractFailurePatterns: async () =\u003e {\n    const recentFailures = await queryRecentFailures(7);\n    const patterns = groupBy(recentFailures, f =\u003e f.stage + ':' + f.failureType);\n    \n    const learnedPatterns = Object.entries(patterns).map(([key, failures]) =\u003e {\n      const [stage, failureType] = key.split(':');\n      return {\n        pattern_id: 'p-' + generateId(),\n        stage: stage,\n        failure_type: failureType,\n        occurrence_count: failures.length,\n        last_occurrence: failures[0].timestamp,\n        resolution_success_rate: calculateSuccessRate(failures),\n        avg_time_to_resolve: calculateAvgTime(failures),\n        recommended_action: getRecommendedAction(stage, failureType)\n      };\n    });\n    \n    await storeInCassMemory('failure_patterns', learnedPatterns);\n  },\n  \n  extractSuccessPatterns: async () =\u003e {\n    const recentSuccesses = await queryRecentSuccesses(7);\n    const patterns = groupBy(recentSuccesses, s =\u003e s.agentType + ':' + s.taskType);\n    \n    const learnedPatterns = Object.entries(patterns).map(([key, successes]) =\u003e {\n      const [agentType, taskType] = key.split(':');\n      return {\n        pattern_id: 'p-' + generateId(),\n        approach: agentType + '_' + taskType,\n        agent_type: agentType,\n        task_type: taskType,\n        success_rate: successes.length / getAttemptCount(agentType, taskType),\n        avg_time_to_complete: calculateAvgTime(successes),\n        recommended: successes.length \u003e= 5\n      };\n    });\n    \n    await storeInCassMemory('success_patterns', learnedPatterns);\n  }\n};\n```\n\n**Context Recommendations:**\n```bash\n# Before starting a task\ncm context \"implementing user authentication\" --json\n\n# Returns:\n{\n  \"relevantBullets\": [\n    {\n      \"rule_id\": \"b-8f3a2c\",\n      \"rule\": \"Always write unit tests before implementing authentication logic\",\n      \"confidence\": 0.95,\n      \"evidence_count\": 42\n    }\n  ],\n  \"antiPatterns\": [\n    {\n      \"pattern_id\": \"ap-7d1b4f\",\n      \"pattern\": \"Never store passwords in plain text\",\n      \"confidence\": 0.99,\n      \"evidence_count\": 156\n    }\n  ],\n  \"historySnippets\": [\n    {\n      \"session_id\": \"ses-abc123\",\n      \"task\": \"Implement OAuth2 login\",\n      \"outcome\": \"success\",\n      \"duration\": \"45 min\",\n      \"approach\": \"test_driven_development\"\n    }\n  ]\n}\n```\n\n### Monitoring Stack\n**Components:**\n- Prometheus: Metrics collection\n- Grafana: Dashboards and visualization\n- Sentry: Error tracking\n- PagerDuty: Alerting\n- ELK Stack: Log aggregation\n\n**Health Check Endpoints:**\n- `/health` - Overall health\n- `/readiness` - Ready to accept traffic\n- `/metrics` - Prometheus metrics\n- `/version` - Service version","notes":"See parent epic: opencode-lsl","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T11:51:56.195022+05:30","created_by":"buddhi","updated_at":"2026-01-08T19:16:27.304356+05:30","closed_at":"2026-01-08T19:16:27.304356+05:30","close_reason":"Completed metrics collection and learning system documentation","dependencies":[{"issue_id":"opencode-g4a","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.296579+05:30","created_by":"buddhi"}]}
{"id":"opencode-h2t","title":"Design enhanced iterative development workflow stages","description":"Design enhanced 6-stage workflow with quality gates and failure handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T11:51:56.199209+05:30","created_by":"buddhi","updated_at":"2026-01-08T11:54:18.171884+05:30","closed_at":"2026-01-08T11:54:18.171884+05:30","close_reason":"Completed: Enhanced 6-stage workflow designed with quality gates and failure handling","dependencies":[{"issue_id":"opencode-h2t","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.062286+05:30","created_by":"buddhi"}]}
{"id":"opencode-hfi","title":"Convert prd.md - remove Factory dependencies","description":"Remove MCP Agent Mail registration code, session initialization blocks, and 'REQUIRED MCP' error raising from agent/prd.md. Keep atomicity rules, clarifying questions workflow, Figma integration, and Senior Engineer Framework methodology.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.01981+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Removed MCP Agent Mail registration code (lines 55-106), session initialization block, and implementation note (lines 469-503). Kept atomicity rules, clarifying questions workflow, Figma integration, and Senior Engineer Framework methodology.","dependencies":[{"issue_id":"opencode-hfi","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:01.020392+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-ivn","title":"Migrate skills from Factory CLI to opencode skills/","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T14:07:42.163209+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed: Skills copied and references updated","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-k4w","title":"Create implementation plan for enhanced workflow","description":"Create 8-week implementation plan with phases and milestones","design":"## Implementation Plan - Enhanced Iterative Workflow\n\n### Phase 1: Foundation (Week 1-2)\n**Week 1: Core Workflow Enhancement**\n- Implement Stage 0 (Discovery \u0026 Planning) enhancements\n- Implement Stage 1 (Test Specification) with test-specialist agent\n- Enhance Stage 2 (Code Implementation) with quality checks\n- Implement Stage 3 (Static Analysis \u0026 Security Scanning)\n- Integrate linting, formatting, and security scanning tools\n\n**Week 2: CI/CD Integration**\n- Create GitHub Actions workflow for CI/CD\n- Implement Stage 4 (Test Execution) automation\n- Implement Stage 5 (Code Review) automation\n- Implement Stage 6 (Deployment \u0026 Monitoring)\n- Set up staging environment\n\n### Phase 2: Automated Failure Handling (Week 3-4)\n**Week 3: Failure Detection \u0026 Task Creation**\n- Implement test output parsing\n- Implement review comment parsing\n- Implement automated task creation for failures\n- Implement priority determination logic\n- Test failure detection and task creation\n\n**Week 4: Retry Logic \u0026 Learning**\n- Implement retry logic with exponential backoff\n- Implement max retries exceeded handling\n- Implement failure pattern learning\n- Implement success pattern learning\n- Integrate with cass_memory\n\n### Phase 3: Metrics \u0026 Monitoring (Week 5-6)\n**Week 5: Metrics Collection**\n- Implement metrics collection system\n- Set up Prometheus metrics endpoint\n- Create Grafana dashboard\n- Track quality metrics\n- Track velocity metrics\n\n**Week 6: Monitoring \u0026 Alerting**\n- Set up error tracking (Sentry)\n- Implement health check endpoints\n- Set up alerting (PagerDuty, Slack)\n- Implement log aggregation (ELK)\n- Test monitoring and alerting\n\n### Phase 4: Testing \u0026 Polish (Week 7-8)\n**Week 7: End-to-End Testing**\n- Create test scenarios for all stages\n- Test automated task creation\n- Test retry logic\n- Test failure learning\n- Test metrics collection\n\n**Week 8: Documentation \u0026 Deployment**\n- Write documentation for new workflow\n- Create troubleshooting guide\n- Train team on new workflow\n- Deploy to production\n- Monitor and iterate\n\n### Success Metrics\n**Workflow Efficiency:**\n- 3-5x faster task execution (parallelism)\n- 93% automation (vs 70% originally)\n- \u003c 10% human intervention rate\n- \u003c 5 min feedback loop time (CI/CD)\n\n**Quality Improvements:**\n- 80%+ test coverage\n- 0 critical security vulnerabilities\n- \u003c 1% flaky test rate\n- \u003c 5% bug escape rate to production\n\n**Velocity Improvements:**\n- 2-3x higher throughput (tasks/week)\n- 50% shorter cycle time\n- 80%+ task completion rate\n- \u003c 5% task abandonment rate\n\n### Dependencies \u0026 Prerequisites\n**Required Tools:**\n- PM2 (process management)\n- GitHub Actions (CI/CD)\n- pytest/jest (test runners)\n- ESLint, Prettier, Black (linting/formatting)\n- Snyk (security scanning)\n- Prometheus/Grafana (metrics)\n- Sentry (error tracking)\n- PagerDuty (alerting)\n\n**New Agents to Implement:**\n- test-specialist: Test generation and execution\n- code-reviewer: Automated code review\n- deployment-specialist: Deployment automation\n\n**Integration Points:**\n- Beads task queue (already installed)\n- MCP Agent Mail (already installed)\n- cass_memory (already installed)\n- orchestrator (already installed)","notes":"See parent epic: opencode-lsl","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T11:51:56.195264+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.781806+05:30","dependencies":[{"issue_id":"opencode-k4w","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.374805+05:30","created_by":"buddhi"}]}
{"id":"opencode-kx9","title":"Define failure detection and task creation patterns","description":"Define automatic task creation patterns for test failures, review comments, and deployment failures","design":"## Failure Detection \u0026 Task Creation Patterns\n\n### Test Failure Detection (Stage 4)\n**Parse test output (pytest, jest, etc.)**\n- Extract failing test names\n- Capture error messages and stack traces\n- Identify failure types (bug, flaky, performance)\n\n**Automatic Task Creation:**\n```javascript\nfailingTests.forEach(test =\u003e {\n  bd.create({\n    title: \"Fix failing test: \" + test.name,\n    description: \"Test failed in \" + test.file + \": \" + test.error,\n    type: 'bug',\n    priority: determinePriority(test.error),\n    depends_on: [currentStage4TaskId],\n    metadata: {\n      test_file: test.file,\n      test_name: test.name,\n      error_message: test.error,\n      stack_trace: test.stack,\n      failure_type: test.failureType\n    }\n  });\n});\n```\n\n**Priority Mappings:**\n- P0: Security test, core functionality\n- P1: Integration/E2E test failure\n- P2: Unit test edge case\n- P3: Performance degradation\n\n### Review Comment Detection (Stage 5)\n**Parse PR comments (GitHub/GitLab API)**\n- Extract comment body, file, line\n- Classify by type: bug, style, architecture, performance, security, documentation, accessibility\n\n**Automatic Task Creation:**\n```javascript\ncommentsByType.forEach(([type, comments]) =\u003e {\n  bd.create({\n    title: getTaskTitle(type),\n    description: formatComments(comments),\n    type: 'improvement',\n    priority: getPriority(type),\n    depends_on: [currentStage5TaskId],\n    metadata: { comment_type: type, count: comments.length }\n  });\n});\n```\n\n**Task Types:**\n- security → \"Fix Security Issues\" (P0)\n- bug → \"Fix Review Bugs\" (P0)\n- architecture → \"Refactor Architecture Issues\" (P1)\n- performance → \"Optimize Performance Issues\" (P1)\n- accessibility → \"Fix Accessibility Issues\" (P1)\n- documentation → \"Add Missing Documentation\" (P2)\n- style → \"Address Style Comments\" (P3)\n\n### Deployment Failure Detection (Stage 6)\n**Monitor deployment events**\n- Deployment failures\n- Smoke test failures\n- Health check failures\n\n**Automatic Task Creation:**\n- P0 \"Rollback failed deployment\" (immediate)\n- P0 \"Investigate deployment failure\" (after rollback)\n- P0 \"Fix failing smoke tests\"\n- P0 \"Fix service health issues\"\n\n### Retry Logic\n**Max Retries:**\n- Stage 0: 1 (manual)\n- Stage 1-5: 3 retries\n- Stage 6: 1 (manual)\n\n**Backoff:**\n- Retry 1: Immediate\n- Retry 2: 5 min\n- Retry 3: 15 min\n\n**Max Retries Exceeded:**\n- Alert developer (email/Slack)\n- Mark task as blocked\n- Create \"Manual Intervention Required\" task\n- Stop auto-requeuing","notes":"See parent epic: opencode-lsl","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T11:52:26.067097+05:30","created_by":"buddhi","updated_at":"2026-01-08T21:49:04.583433+05:30","closed_at":"2026-01-08T21:49:04.583433+05:30","close_reason":"Completed via beads plugin","dependencies":[{"issue_id":"opencode-kx9","depends_on_id":"opencode-h2t","type":"blocks","created_at":"2026-01-08T11:52:26.06853+05:30","created_by":"buddhi"},{"issue_id":"opencode-kx9","depends_on_id":"opencode-lsl","type":"parent-child","created_at":"2026-01-08T12:00:08.219063+05:30","created_by":"buddhi"}]}
{"id":"opencode-lq1","title":"Migrate Factory droids to opencode (orchestrator, PRD, generate-tasks, task-coordinator, research droids)","description":"Migrate all Factory droid definitions to ~/.config/opencode/droids/. Adapt orchestrator (2000+ lines) to use cass_memory instead of Factory CLS. Update AGENTS.md to include droid directory. Research droids (codebase-researcher, git-history-analyzer, context-researcher, best-practices-researcher, library-source-reader, domain-specialist) remain as-is. PRD and task droids adapted for opencode context.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T11:57:02.530412+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"All 14 agents already migrated from Factory droids: orchestrator (726 lines), PRD, generate-tasks, task-coordinator, 7 research droids, semantic-search, figma-design-extractor, MESSAGE_FORMATS, README-ai-dev-tasks. Memory paths updated from ~/.factory to ~/.config/opencode","dependencies":[{"issue_id":"opencode-lq1","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:57:02.531745+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-lsl","title":"OpenCode Headless Swarm - Enhanced Workflow Design Epic","description":"Epic for implementing enhanced iterative development workflow with 6 stages, automatic failure handling, CI/CD integration, and continuous learning system. This is a comprehensive enhancement to the OpenCode Headless Swarm architecture.","design":"## OpenCode Headless Swarm - Complete Architecture\n\n### Overview\nThis epic implements a comprehensive 6-stage iterative development workflow with parallel execution, automatic failure handling, CI/CD integration, and continuous learning system. The architecture leverages existing opencode agents and tools while adding minimal new infrastructure.\n\n### Core Architecture\n\n#### 6-Stage Workflow\n1. **Stage 0: Discovery \u0026 Planning** - PRD validation, risk assessment, atomic task generation\n2. **Stage 1: Test Specification** - Automated test generation with test-specialist agent\n3. **Stage 2: Code Implementation** - Enhanced with quality checks, type safety, error handling\n4. **Stage 3: Static Analysis \u0026 Security** - Linting, security scanning, complexity analysis\n5. **Stage 4: Test Execution** - Automated testing with failure detection and task creation\n6. **Stage 5: Code Review** - Automated review checks, comment parsing, task creation\n7. **Stage 6: Deployment \u0026 Monitoring** - Deployment automation, monitoring setup\n\n#### Headless Swarm Architecture\n**Process Management (PM2):**\n- 4 parallel worker instances (configurable: pm2 scale headless-swarm 8)\n- Stateless workers: claim → execute → exit (PM2 restarts)\n- Auto-restart on crash (max 10 restarts)\n- Memory limit: 1GB (max_memory_restart)\n- No custom CLI - uses PM2 built-in commands\n\n**Task Queue (Beads):**\n- Dependency graph for task orchestration\n- Worker polls: `bd ready` for available tasks\n- Worker claims: `bd update \u003cid\u003e --status in_progress`\n- Worker completes: `bd close \u003cid\u003e --reason=\"Completed\"`\n- Failed tasks auto-create dependent tasks\n\n**File Locking (MCP Agent Mail):**\n- Uses existing `reserve_file_paths()` and `release_file_reservations()`\n- Prevents concurrent edits (no git conflicts)\n- TTL-based auto-release (if worker crashes)\n- Lock conflict resolution (grants first, denies second)\n- No custom endpoints needed\n\n### Core Features\n\n#### 1. Automatic Task Creation\n**Test Failures (Stage 4):**\n- Parse test output (pytest, jest, etc.)\n- Extract failing test names, errors, stack traces\n- Create individual tasks: \"Fix failing test: \u003ctest_name\u003e\"\n- Priority mapping: P0 (security/core), P1 (integration/E2E), P2 (unit edge case), P3 (performance)\n\n**Review Comments (Stage 5):**\n- Parse PR comments (GitHub/GitLab API)\n- Classify by type: bug, style, architecture, performance, security, documentation, accessibility\n- Create grouped tasks by type\n- Task types: \"Fix Security Issues\" (P0), \"Fix Review Bugs\" (P0), \"Refactor Architecture Issues\" (P1), \"Optimize Performance Issues\" (P1), \"Fix Accessibility Issues\" (P1), \"Add Missing Documentation\" (P2), \"Address Style Comments\" (P3)\n\n**Deployment Failures (Stage 6):**\n- Monitor deployment events\n- Create tasks: \"Rollback failed deployment\" (P0), \"Investigate deployment failure\" (P0), \"Fix failing smoke tests\" (P0), \"Fix service health issues\" (P0)\n\n#### 2. Retry Logic\n**Max Retries per Stage:**\n- Stage 0 (Discovery): 1 retry (manual intervention)\n- Stage 1 (Test Spec): 3 retries\n- Stage 2 (Implementation): 3 retries\n- Stage 3 (Static Analysis): 3 retries\n- Stage 4 (Test Execution): 3 retries\n- Stage 5 (Code Review): 3 retries\n- Stage 6 (Deployment): 1 retry (manual intervention)\n\n**Exponential Backoff:**\n- Retry 1: Immediate\n- Retry 2: 5 min\n- Retry 3: 15 min\n\n**Max Retries Exceeded:**\n- Alert developer (email, Slack webhook)\n- Mark task as blocked\n- Create \"Manual Intervention Required\" task\n- Stop automatic re-queuing for this task\n\n#### 3. Cass Memory Integration\n**Failure Pattern Learning:**\n- Track: Stage failures, failure types, occurrence count, resolution success rate, avg time to resolve\n- Extract patterns from last 7 days\n- Recommended action based on patterns\n- Store in cass_memory as `failure_patterns`\n\n**Success Pattern Learning:**\n- Track: Agent type, task type, success rate, avg time to complete\n- Extract patterns from last 7 days\n- Recommended: Only if ≥5 data points\n- Store in cass_memory as `success_patterns`\n\n**Context Recommendations:**\n```bash\n# Before starting task\ncm context \"implementing user authentication\" --json\n\n# Returns:\n{\n  \"relevantBullets\": [\n    {\n      \"rule_id\": \"b-8f3a2c\",\n      \"rule\": \"Always write unit tests before implementing authentication logic\",\n      \"confidence\": 0.95,\n      \"evidence_count\": 42\n    }\n  ],\n  \"antiPatterns\": [\n    {\n      \"pattern_id\": \"ap-7d1b4f\",\n      \"pattern\": \"Never store passwords in plain text\",\n      \"confidence\": 0.99,\n      \"evidence_count\": 156\n    }\n  ]\n}\n```\n\n### Quality Gates\n\n#### CI/CD Pipeline (Stages 3-6)\n**Stage 3: Static Analysis \u0026 Security:**\n- Linting: ESLint, Prettier, Black, pylint\n- Security: Snyk, OWASP ZAP, npm audit, pip-audit\n- Complexity: Cyclomatic complexity ≤ 10\n- Duplicates: ≤ 3% duplication\n- Dependencies: No vulnerable dependencies\n\n**Stage 4: Test Execution:**\n- Unit tests: 100% pass rate\n- Integration tests: 100% pass rate\n- E2E tests: 100% pass rate\n- Coverage: ≥ 80%\n- Flaky tests: ≤ 1% rate\n- Performance: No regression\n\n**Stage 5: Code Review:**\n- PR size: ≤ 400 lines\n- TODO/FIXME: 0 comments\n- Debug statements: 0 console.log/debugger\n- Documentation: All functions documented\n- Migration guide: Required for breaking changes\n\n**Stage 6: Deployment:**\n- Staging: Successful deployment\n- Smoke tests: All pass\n- Health checks: All pass\n- Monitoring: Configured\n- Error tracking: Configured (Sentry)\n- Rollback: Plan tested\n\n### Metrics \u0026 Monitoring\n\n#### Metrics to Track\n**Quality Metrics:**\n- Code coverage percentage\n- Defect escape rate (bugs in production)\n- Mean time to detection (MTTD)\n- Mean time to resolution (MTTR)\n- Technical debt ratio\n- Code churn (lines changed/week)\n\n**Velocity Metrics:**\n- Lead time (idea to production)\n- Cycle time (start to finish)\n- Throughput (tasks/week)\n- Task completion rate\n- Average task duration\n- Deployment frequency\n\n**Workflow Metrics:**\n- Test execution time\n- Pipeline success rate\n- Flaky test rate\n- Average PR size\n- Review turnaround time\n- Rollback frequency\n\n**AI Assistance Metrics:**\n- AI task completion rate\n- AI-generated code acceptance rate\n- Time saved by AI assistance\n- AI prompt success rate\n- Human intervention rate\n\n#### Monitoring Stack\n- **Prometheus**: Metrics collection\n- **Grafana**: Dashboards and visualization\n- **Sentry**: Error tracking\n- **PagerDuty**: Alerting\n- **ELK Stack**: Log aggregation\n\n### Success Metrics\n\n#### Workflow Efficiency\n- 3-5x faster task execution (parallelism)\n- 93% automation (vs 70% originally)\n- \u003c 10% human intervention rate\n- \u003c 5 min feedback loop time (CI/CD)\n\n#### Quality Improvements\n- 80%+ test coverage\n- 0 critical security vulnerabilities\n- \u003c 1% flaky test rate\n- \u003c 5% bug escape rate to production\n\n#### Velocity Improvements\n- 2-3x higher throughput (tasks/week)\n- 50% shorter cycle time\n- 80%+ task completion rate\n- \u003c 5% task abandonment rate\n\n### Implementation Summary\n\n**What We Have (Ready to Use):**\n- ✅ PRD Generator (prd)\n- ✅ Task Breakdown (generate-tasks)\n- ✅ Task Tracking (bd)\n- ✅ Task Prioritization (bv)\n- ✅ Agent Coordination (MCP Agent Mail)\n- ✅ Task Coordinator\n- ✅ Orchestrator\n- ✅ Research Droids (9 types)\n- ✅ Memory System (cass_memory)\n- ❌ PM2 (needs npm install -g pm2)\n\n**What Needs Implementation:**\n1. **PM2 ecosystem configuration** (12 lines)\n2. **Headless worker script** (30 lines)\n3. **test-specialist agent** (new)\n4. **code-reviewer agent** (new)\n5. **deployment-specialist agent** (new)\n6. **CI/CD pipeline** (GitHub Actions)\n7. **Testing infrastructure** (pytest/jest)\n8. **Code quality tools** (ESLint, Prettier, Snyk)\n9. **Monitoring stack** (Prometheus, Grafana, Sentry)\n\n**Total Code to Write:**\n- Headless worker + PM2 config: ~42 lines\n- New specialist agents: ~2000 lines\n- CI/CD pipeline: ~500 lines\n- Test infrastructure: ~800 lines\n- Monitoring integration: ~600 lines\n\n**Implementation Time:**\n- **Phase 1** (Foundation): 2 weeks\n- **Phase 2** (Failure Handling): 2 weeks\n- **Phase 3** (Metrics): 2 weeks\n- **Phase 4** (Testing): 2 weeks\n- **Total**: 8 weeks\n\n### Edge Cases \u0026 Handling\n\n1. **Worker crashes** → PM2 auto-restarts, MCP detects no heartbeat and auto-releases task lock after 5min\n2. **No tasks available** → Worker sleeps 5s, exits, PM2 restarts\n3. **File reservation denied** → Retry 3x with 5s delay, exit if still denied\n4. **Task execution failure** → Create dependent task, release reservations, exit\n5. **Network partition** → MCP server heartbeat timeout triggers lock auto-release, tasks re-claimable on reconnect\n6. **All tasks fail repeatedly** → PM2 restart limit (10x) reached, instance stops claiming new tasks, alerts developer\n7. **Machine runs out of RAM** → PM2 max_memory_restart threshold triggers worker restart\n8. **Two workers claim same task simultaneously** → MCP grants lock to first requester, denies second (worker exits, claims different task)\n9. **Worker stuck in infinite loop** → MCP detects no heartbeat, auto-releases lock after timeout, another worker reclaims task","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-08T11:59:31.071549+05:30","created_by":"buddhi","updated_at":"2026-01-08T21:48:11.875245+05:30","closed_at":"2026-01-08T21:48:11.875245+05:30","close_reason":"Completed via beads plugin"}
{"id":"opencode-n42","title":"Document atomic task implementation step-by-step dev process","description":"Complete lifecycle of implementing a single atomic task from Discovery to Deployment, with all substeps, commands, and success criteria","design":"# Atomic Task Implementation - Step-by-Step Dev Process\n\n## Overview\nComplete lifecycle of implementing a single atomic task from start to finish, following the 6-stage enhanced workflow.\n\n## Stage 0: Discovery \u0026 Planning (15-30 min)\n\n### Step 0.1: Get Context from cass_memory\n```bash\ncm context \"implementing user authentication\" --json\n```\n\n**Returns:**\n- `relevantBullets` - Rules to follow (e.g., \"Always write unit tests first\")\n- `antiPatterns` - Pitfalls to avoid (e.g., \"Never store passwords in plain text\")\n- `historySnippets` - Similar past sessions with outcomes\n\n**Action:** Include relevant rules in task prompt/implementation notes.\n\n### Step 0.2: Review Requirements\n**Input:**\n- PRD document or task description\n- Figma design specification (if applicable)\n- Acceptance criteria\n\n**Action:** Understand what needs to be built, success criteria, constraints.\n\n### Step 0.3: Verify Task is Atomic\n**Check:**\n- Task size: ≤4 hours estimated\n- File count: ≤3 files touched\n- Dependencies: Clearly identified\n- No circular dependencies\n\n**Action:** If task too large, split into smaller tasks.\n\n**Output:** Ready to start Stage 1.\n\n---\n\n## Stage 1: Test Specification \u0026 Generation (30-60 min)\n\n### Step 1.1: Analyze Acceptance Criteria\n**Input:** Feature requirements, Figma designs\n\n**Action:** Break down requirements into testable scenarios.\n\n**Example:**\n```\nRequirement: User can login with email and password\n\nTest Scenarios:\n1. Valid credentials → Login successful\n2. Invalid email → Error message\n3. Invalid password → Error message\n4. Empty fields → Validation errors\n5. Rate limiting → Throttle after 5 failed attempts\n```\n\n### Step 1.2: Generate Unit Tests\n**Tool:** test-specialist agent or manual\n\n**Create:** `tests/unit/auth.test.js`\n\n```javascript\ndescribe('User Authentication', () =\u003e {\n  test('should login with valid credentials', async () =\u003e {\n    const result = await login('user@example.com', 'password123');\n    expect(result.success).toBe(true);\n    expect(result.token).toBeDefined();\n  });\n\n  test('should reject invalid email', async () =\u003e {\n    const result = await login('invalid-email', 'password123');\n    expect(result.success).toBe(false);\n    expect(result.error).toBe('Invalid email format');\n  });\n\n  test('should reject invalid password', async () =\u003e {\n    const result = await login('user@example.com', 'wrong-password');\n    expect(result.success).toBe(false);\n    expect(result.error).toBe('Invalid credentials');\n  });\n});\n```\n\n### Step 1.3: Generate Integration Tests\n**Create:** `tests/integration/auth-flow.test.js`\n\n```javascript\ndescribe('Authentication Flow', () =\u003e {\n  test('should complete full login flow', async () =\u003e {\n    // 1. User submits login form\n    await page.fill('[name=\"email\"]', 'user@example.com');\n    await page.fill('[name=\"password\"]', 'password123');\n    await page.click('[type=\"submit\"]');\n\n    // 2. Verify redirect to dashboard\n    expect(page.url()).toContain('/dashboard');\n\n    // 3. Verify token stored\n    const token = await page.evaluate(() =\u003e localStorage.getItem('authToken'));\n    expect(token).toBeDefined();\n  });\n});\n```\n\n### Step 1.4: Generate E2E Tests\n**Tool:** Playwright or Cypress\n\n**Create:** `tests/e2e/login-e2e.test.js`\n\n```javascript\ntest('User login E2E', async ({ page }) =\u003e {\n  await page.goto('/login');\n  \n  // Fill and submit form\n  await page.fill('[name=\"email\"]', 'user@example.com');\n  await page.fill('[name=\"password\"]', 'password123');\n  await page.click('[type=\"submit\"]');\n  \n  // Verify success\n  await expect(page.locator('.dashboard')).toBeVisible();\n});\n```\n\n### Step 1.5: Create Test Fixtures\n**Create:** `tests/fixtures/auth-fixtures.js`\n\n```javascript\nmodule.exports = {\n  validUser: {\n    email: 'test@example.com',\n    password: 'SecurePass123!'\n  },\n  invalidUser: {\n    email: 'invalid-email',\n    password: 'wrong-password'\n  }\n};\n```\n\n### Step 1.6: Create Test Mocks\n**Create:** `tests/mocks/api-mocks.js`\n\n```javascript\nmodule.exports = {\n  loginSuccess: {\n    success: true,\n    token: 'mock-jwt-token-123'\n  },\n  loginFailure: {\n    success: false,\n    error: 'Invalid credentials'\n  }\n};\n```\n\n### Step 1.7: Update package.json Scripts\n```json\n{\n  \"scripts\": {\n    \"test\": \"jest\",\n    \"test:unit\": \"jest tests/unit\",\n    \"test:integration\": \"jest tests/integration\",\n    \"test:e2e\": \"playwright test\",\n    \"test:coverage\": \"jest --coverage\"\n  }\n}\n```\n\n**Output:**\n- `test-specification.md` - Test plan document\n- `tests/unit/*.test.js` - Unit tests\n- `tests/integration/*.test.js` - Integration tests\n- `tests/e2e/*.test.js` - E2E tests\n- `tests/fixtures/*.js` - Test fixtures\n- `tests/mocks/*.js` - Test mocks\n- `package.json` - Updated test scripts\n\n**Success Criteria:**\n- ✅ All acceptance criteria have corresponding tests\n- ✅ Test files created\n- ✅ Fixtures and mocks created\n- ✅ Test scripts added to package.json\n\n---\n\n## Stage 2: Code Implementation (60-120 min)\n\n### Step 2.1: Create/Modify Source Files\n**Tool:** Specialist droids or manual\n\n**Create:** `src/auth/login.js`\n\n```javascript\nimport { validateEmail, validatePassword } from './validators';\nimport { hashPassword } from './crypto';\nimport { generateToken } from './jwt';\n\nexport async function login(email, password) {\n  // Validate inputs\n  if (!validateEmail(email)) {\n    return { success: false, error: 'Invalid email format' };\n  }\n  if (!validatePassword(password)) {\n    return { success: false, error: 'Password too weak' };\n  }\n\n  // Check rate limiting\n  const attempts = await getLoginAttempts(email);\n  if (attempts \u003e= 5) {\n    return { success: false, error: 'Too many attempts, try again in 15 min' };\n  }\n\n  // Find user\n  const user = await findUserByEmail(email);\n  if (!user) {\n    await recordFailedLoginAttempt(email);\n    return { success: false, error: 'Invalid credentials' };\n  }\n\n  // Verify password\n  const isValid = await verifyPassword(password, user.passwordHash);\n  if (!isValid) {\n    await recordFailedLoginAttempt(email);\n    return { success: false, error: 'Invalid credentials' };\n  }\n\n  // Generate token\n  const token = generateToken({ userId: user.id });\n\n  // Reset login attempts\n  await resetLoginAttempts(email);\n\n  return { success: true, token, user: { id: user.id, email: user.email } };\n}\n```\n\n### Step 2.2: Create Type Definitions (if TypeScript)\n**Create:** `src/auth/types.ts`\n\n```typescript\nexport interface LoginRequest {\n  email: string;\n  password: string;\n}\n\nexport interface LoginResponse {\n  success: boolean;\n  token?: string;\n  user?: { id: string; email: string };\n  error?: string;\n}\n```\n\n### Step 2.3: Create Error Handling\n**Create:** `src/auth/errors.js`\n\n```javascript\nexport class AuthenticationError extends Error {\n  constructor(message, code) {\n    super(message);\n    this.name = 'AuthenticationError';\n    this.code = code;\n  }\n}\n\nexport function handleAuthError(error) {\n  if (error instanceof AuthenticationError) {\n    return {\n      status: 401,\n      body: { error: error.message, code: error.code }\n    };\n  }\n  throw error;\n}\n```\n\n### Step 2.4: Add Dependencies to package.json\n```json\n{\n  \"dependencies\": {\n    \"bcrypt\": \"^5.1.0\",\n    \"jsonwebtoken\": \"^9.0.0\"\n  }\n}\n```\n\n### Step 2.5: Install Dependencies\n```bash\nnpm install\n```\n\n**Output:**\n- Source code files (implementation)\n- Type definitions (if TypeScript)\n- Error handling modules\n- Updated package.json with dependencies\n\n**Success Criteria:**\n- ✅ Implementation matches test specifications\n- ✅ All imports and dependencies resolved\n- ✅ Code follows project conventions\n- ✅ Type safety enforced (TypeScript, mypy, etc.)\n- ✅ No hardcoded secrets or values\n- ✅ Error handling implemented\n\n---\n\n## Stage 3: Static Analysis \u0026 Security Scanning (15-30 min)\n\n### Step 3.1: Run Linter\n```bash\nnpm run lint\n```\n\n**Expected:** 0 errors, ≤10 warnings\n\n**Action:** Fix any lint errors.\n\n### Step 3.2: Run Type Checker\n```bash\nnpm run typecheck\n```\n\n**Expected:** 0 type errors\n\n**Action:** Fix any type errors.\n\n### Step 3.3: Run Formatter\n```bash\nnpm run format\n```\n\n**Expected:** Code formatted consistently\n\n### Step 3.4: Run Security Scan (Snyk)\n```bash\nnpx snyk test\n```\n\n**Expected:** 0 vulnerabilities\n\n**Action:** Update vulnerable dependencies or fix code issues.\n\n### Step 3.5: Run Dependency Audit\n```bash\nnpm audit\n```\n\n**Expected:** 0 critical vulnerabilities\n\n**Action:** Update dependencies to fix vulnerabilities.\n\n### Step 3.6: Check Code Complexity\n```bash\nnpx complexity-report src/auth/login.js\n```\n\n**Expected:** Cyclomatic complexity ≤ 10\n\n**Action:** Refactor if too complex.\n\n**Output:**\n- `lint-report.json` - Linting results\n- `security-report.json` - Security scan results\n- `complexity-report.json` - Code complexity analysis\n- `dependency-report.json` - Dependency vulnerability report\n\n**Success Criteria:**\n- ✅ Linting passes (0 errors)\n- ✅ No security vulnerabilities (0 critical)\n- ✅ Code complexity ≤ 10\n- ✅ Dependencies secure and updated\n\n---\n\n## Stage 4: Test Execution \u0026 Validation (15-30 min)\n\n### Step 4.1: Run Unit Tests\n```bash\nnpm run test:unit\n```\n\n**Expected:** 100% pass rate\n\n**Action:** If tests fail, go to Step 4.6.\n\n### Step 4.2: Run Integration Tests\n```bash\nnpm run test:integration\n```\n\n**Expected:** 100% pass rate\n\n**Action:** If tests fail, go to Step 4.6.\n\n### Step 4.3: Run E2E Tests\n```bash\nnpm run test:e2e\n```\n\n**Expected:** 100% pass rate\n\n**Action:** If tests fail, go to Step 4.6.\n\n### Step 4.4: Check Test Coverage\n```bash\nnpm run test:coverage\n```\n\n**Expected:** ≥ 80% coverage\n\n**Action:** If coverage \u003c 80%, go to Step 4.6.\n\n### Step 4.5: Check Performance Benchmarks\n```bash\nnpm run test:performance\n```\n\n**Expected:** No regression from baseline\n\n**Action:** If performance degraded, go to Step 4.6.\n\n### Step 4.6: Fix Cycle (If Any Test Fails)\n\n#### 4.6.1: Analyze Failure\n```bash\n# View detailed test output\nnpm run test:unit -- --verbose\n\n# View coverage report\nopen coverage/index.html\n```\n\n**Action:** Identify root cause of failure.\n\n#### 4.6.2: Fix Implementation\n```bash\n# Edit source files to fix the issue\nvim src/auth/login.js\n```\n\n**Action:** Apply fix based on test failure.\n\n#### 4.6.3: Re-run Tests\n```bash\nnpm run test:unit\n```\n\n**Expected:** All tests now pass.\n\n**Action:** Repeat 4.6.1 - 4.6.3 until all tests pass.\n\n**Max Retries:** 3 iterations\n\n**Output:**\n- `test-results.json` - Comprehensive test results\n- `coverage-report.json` - Coverage analysis\n- `performance-report.json` - Performance metrics\n\n**Success Criteria:**\n- ✅ Unit tests pass (100%)\n- ✅ Integration tests pass (100%)\n- ✅ E2E tests pass (100%)\n- ✅ Test coverage ≥ 80%\n- ✅ No performance regression\n\n---\n\n## Stage 5: Code Review \u0026 Validation (15-30 min)\n\n### Step 5.1: Run Automated Review Checks\n\n#### 5.1.1: Check PR Size\n```bash\ngit diff origin/main --shortstat\n```\n\n**Expected:** ≤ 400 lines changed\n\n**Action:** If PR too large, split into smaller PRs.\n\n#### 5.1.2: Check for TODO/FIXME\n```bash\ngrep -r \"TODO\\|FIXME\" src/\n```\n\n**Expected:** 0 occurrences\n\n**Action:** Resolve or remove TODO/FIXME comments.\n\n#### 5.1.3: Check for Debug Statements\n```bash\ngrep -r \"console.log\\|debugger\" src/\n```\n\n**Expected:** 0 occurrences\n\n**Action:** Remove debug statements.\n\n#### 5.1.4: Check Documentation\n```bash\n# Check all functions have JSDoc/Docstring\nnpx documentation src/auth/login.js\n```\n\n**Expected:** All functions documented\n\n**Action:** Add missing documentation.\n\n### Step 5.2: Run Code Review Agent\n**Tool:** code-reviewer agent\n\n**Input:**\n- PR diff\n- Test results\n- Coverage report\n\n**Output:** Automated review with categorized comments.\n\n### Step 5.3: Address Review Comments (if any)\n\n#### 5.3.1: Parse Review Comments\n**Tool:** code-reviewer agent\n\n**Categories:**\n- `security` → \"Fix Security Issues\" (P0)\n- `bug` → \"Fix Review Bugs\" (P0)\n- `architecture` → \"Refactor Architecture Issues\" (P1)\n- `performance` → \"Optimize Performance Issues\" (P1)\n- `accessibility` → \"Fix Accessibility Issues\" (P1)\n- `documentation` → \"Add Missing Documentation\" (P2)\n- `style` → \"Address Style Comments\" (P3)\n\n#### 5.3.2: Create Tasks for Each Category\n```bash\n# Example: If security issues found\nbd create \\\n  --title=\"Fix Security Issues\" \\\n  --description=\"Code review found security vulnerabilities:\\n\\n1. SQL injection risk in login function\\n2. Missing rate limiting\" \\\n  --type=bug \\\n  --priority=0 \\\n  --depends_on=[currentTaskId]\n```\n\n#### 5.3.3: Fix Issues\n```bash\n# Edit source files to address comments\nvim src/auth/login.js\n```\n\n**Action:** Apply fixes based on review comments.\n\n#### 5.3.4: Re-run Tests\n```bash\nnpm run test\nnpm run lint\n```\n\n**Expected:** All checks still pass after fixes.\n\n**Output:**\n- `code-review-report.json` - Automated review results\n- `performance-assessment.json` - Performance impact analysis\n- `security-assessment.json` - Security implications\n- `accessibility-report.json` - A11y compliance\n- `documentation-checklist.json` - Documentation verification\n\n**Success Criteria:**\n- ✅ Automated review checks pass\n- ✅ Design patterns followed\n- ✅ Performance implications assessed\n- ✅ Security implications verified\n- ✅ Documentation complete\n- ✅ All review comments addressed (if any)\n\n---\n\n## Stage 6: Deployment \u0026 Monitoring (15-30 min)\n\n### Step 6.1: Commit Changes\n```bash\ngit add .\ngit commit -m \"Implement user authentication\n\n- Add login function with email/password validation\n- Add rate limiting (5 failed attempts)\n- Add JWT token generation\n- Add error handling\n- Add unit tests (100% coverage)\n- Add integration tests\n- Add E2E tests\n\nTests: Unit 12/12 ✓, Integration 3/3 ✓, E2E 2/2 ✓\nCoverage: 85%\nSecurity: 0 vulnerabilities\"\n```\n\n### Step 6.2: Run Pre-commit Hooks (Automatic)\n**Trigger:** `git commit`\n\n**What runs automatically:**\n1. ESLint on staged files\n2. Prettier formatting\n3. TypeScript type checking\n4. Black/Pylint for Python files\n5. Auto-add formatted files\n\n**Expected:** All hooks pass\n\n**Action:** If hooks fail, fix and re-commit.\n\n### Step 6.3: Push to Remote\n```bash\ngit push origin feature/user-authentication\n```\n\n### Step 6.4: Deploy to Staging (if applicable)\n```bash\nnpm run deploy:staging\n```\n\n**Expected:** Deployment successful\n\n### Step 6.5: Run Smoke Tests\n```bash\nnpm run test:smoke\n```\n\n**Expected:** All smoke tests pass\n\n**Action:** If smoke tests fail, rollback deployment.\n\n### Step 6.6: Check Health Endpoints\n```bash\ncurl https://staging.example.com/health\n```\n\n**Expected:** Status: OK\n\n**Action:** If health checks fail, investigate logs.\n\n### Step 6.7: Monitor for Issues\n**Tools:**\n- Sentry (error tracking)\n- Prometheus/Grafana (metrics)\n- PagerDuty (alerting)\n\n**Duration:** Monitor for 15-30 minutes after deployment.\n\n**Action:** If issues detected, create rollback task.\n\n**Output:**\n- `deployment-report.json` - Deployment results\n- `health-check-report.json` - Service health status\n- `monitoring-config.json` - Monitoring configuration\n\n**Success Criteria:**\n- ✅ Staging deployment successful\n- ✅ Smoke tests pass\n- ✅ Health checks pass\n- ✅ Monitoring configured\n- ✅ No errors in last 30 minutes\n\n---\n\n## Complete Atomic Task Lifecycle Summary\n\n```\nStage 0: Discovery (15-30 min)\n  ├── Get cass_memory context\n  ├── Review requirements\n  └── Verify task is atomic\n\nStage 1: Test Specification (30-60 min)\n  ├── Analyze acceptance criteria\n  ├── Generate unit tests\n  ├── Generate integration tests\n  ├── Generate E2E tests\n  ├── Create fixtures\n  ├── Create mocks\n  └── Update package.json\n\nStage 2: Code Implementation (60-120 min)\n  ├── Create/modify source files\n  ├── Add type definitions\n  ├── Create error handling\n  ├── Add dependencies\n  └── Install dependencies\n\nStage 3: Static Analysis (15-30 min)\n  ├── Run linter\n  ├── Run type checker\n  ├── Run formatter\n  ├── Run security scan\n  ├── Run dependency audit\n  └── Check code complexity\n\nStage 4: Test Execution (15-30 min)\n  ├── Run unit tests → [Fail?] → Fix → Retry\n  ├── Run integration tests → [Fail?] → Fix → Retry\n  ├── Run E2E tests → [Fail?] → Fix → Retry\n  ├── Check coverage (≥80%)\n  └── Check performance (no regression)\n\nStage 5: Code Review (15-30 min)\n  ├── Run automated checks (PR size, TODO/FIXME, debug statements)\n  ├── Run code-reviewer agent\n  ├── Parse review comments\n  ├── Create tasks for issues\n  ├── Fix issues\n  └── Re-run tests\n\nStage 6: Deployment (15-30 min)\n  ├── Commit changes (pre-commit hooks run automatically)\n  ├── Push to remote\n  ├── Deploy to staging\n  ├── Run smoke tests\n  ├── Check health endpoints\n  └── Monitor for issues\n```\n\n**Total Time:** 2.5 - 5 hours per atomic task\n\n**Automation Level:** 93% (manual intervention only for complex issues)\n\n**Quality Gates:** All stages must pass before proceeding to next stage.\n\n**Failure Handling:** Each stage creates dependent tasks if failures occur.\n\n**Learning:** cass_memory captures patterns from successes and failures.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T13:23:27.893575+05:30","created_by":"buddhi","updated_at":"2026-01-08T13:43:50.366453+05:30","closed_at":"2026-01-08T13:43:50.366453+05:30","close_reason":"Already completed - atomic steps in docs/ATOMIC_TASK_IMPLEMENTATION_STEPS.md"}
{"id":"opencode-o0b","title":"Create hook-based service check architecture for opencode","description":"Design and implement hook-based service check system for opencode. Checks (don't install) if cass_memory, MCP Agent Mail, Beads CLI, and Beads Viewer (bv) are available. Services should be installed independently in tool-agnostic locations (~/.cass-memory, ~/.mcp-agent-mail, ~/.local/bin/). Create ~/.config/opencode/hooks/session-start.sh as main entry point calling individual check hooks.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:32.415663+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Implemented hook-based service check system with 5 hooks (session-start.sh, check-cass-memory.sh, check-mcp-agent-mail.sh, check-beads.sh, check-bv.sh)","dependencies":[{"issue_id":"opencode-o0b","depends_on_id":"opencode-0bc","type":"blocks","created_at":"2026-01-06T11:56:32.416964+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-pqy","title":"Investigate and plan agent migration","description":"Research Factory droid changes, identify atomicity improvements, and plan migration strategy. Verify all atomicity changes are present in opencode agents.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T18:42:24.601711+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Investigation already complete - verified atomicity changes present, migration plan completed, all conversion tasks executed successfully.","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-toi","title":"Clone and install MCP Agent Mail","description":"Clone MCP Agent Mail repository to ~/.mcp_agent_mail, create .env configuration, and install dependencies with uv sync. This is REQUIRED for opencode headless mode.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:44:28.384051+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Cloned MCP Agent Mail to ~/.mcp_agent_mail, created .env config, installed Python 3.14 and dependencies with uv sync. Server running on http://127.0.0.1:8765","deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-vvz","title":"Implement headless worker script for local testing","description":"Create 30-line stateless headless worker that claims Beads tasks, reserves files via MCP, executes via opencode, and exits for PM2 restart","design":"## Create Headless Worker Script\n\n### Purpose\nCreate 30-line stateless headless worker for local testing of task execution\n\n### File Location\n`~/.config/opencode/bin/headless-worker.js`\n\n### Worker Lifecycle\n```javascript\n#!/usr/bin/env node\n\nconst { execSync } = require('child_process');\n\nfunction run(cmd) {\n  try {\n    return execSync(cmd, { encoding: 'utf8' }).trim();\n  } catch (error) {\n    console.error(`Command failed: ${cmd}`);\n    throw error;\n  }\n}\n\n// 1. Poll Beads for available tasks\nconst readyOutput = run('bd ready');\nif (!readyOutput || readyOutput.includes('No ready work')) {\n  console.log('No tasks available, sleeping 5s then exiting');\n  setTimeout(() =\u003e process.exit(0), 5000);\n  return;\n}\n\n// 2. Extract task_id from output\nconst taskId = readyOutput.split(' ')[0];\nconsole.log(`Claimed task: ${taskId}`);\n\n// 3. Reserve file paths via MCP\ntry {\n  run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n} catch (error) {\n  console.log('File reservation denied, retrying...');\n  // Retry logic up to 3x\n  for (let i = 0; i \u003c 3; i++) {\n    try {\n      setTimeout(() =\u003e {}, 5000);\n      run(`python3 -c \"from mcp_agent_mail_client import reserve_file_paths; import asyncio; asyncio.run(reserve_file_paths(agent_name='headless-worker', paths=['src/**/*', 'tests/**/*'], ttl_seconds=3600))\"`);\n      break;\n    } catch (retryError) {\n      if (i === 2) {\n        console.log('Reservation failed after 3 retries, exiting');\n        process.exit(1);\n      }\n    }\n  }\n}\n\n// 4. Execute task using opencode\ntry {\n  run(`opencode-task ${taskId}`);\n  \n  // 5. On success - complete task\n  run(`bd close ${taskId} --reason=\"Completed\"`);\n  console.log(`Task ${taskId} completed successfully`);\n} catch (error) {\n  // 6. On failure - create dependent task (if applicable)\n  console.error(`Task ${taskId} failed: ${error.message}`);\n  // Dependent task creation happens in CI/CD or review stage\n}\n\n// 7. Release file reservations via MCP\nrun(`python3 -c \"from mcp_agent_mail_client import release_file_reservations; import asyncio; asyncio.run(release_file_reservations(agent_name='headless-worker'))\"}`);\n\n// 8. Exit -\u003e PM2 restarts -\u003e claims next task\nprocess.exit(0);\n```\n\n### Create Bin Directory\n```bash\nmkdir -p ~/.config/opencode/bin\n```\n\n### Make Script Executable\n```bash\nchmod +x ~/.config/opencode/bin/headless-worker.js\n```\n\n### Key Features\n- **Stateless**: Worker exits after each task, PM2 restarts\n- **File Reservations**: Uses existing MCP Agent Mail functions\n- **No Custom Endpoints**: Leverages existing infrastructure\n- **Error Handling**: Retry logic for file reservations\n- **Exit on Completion**: PM2 auto-restarts for next task\n\n### Required Components\n- Beads task claiming (bd ready, bd show, bd close)\n- MCP file reservations (reserve_file_paths, release_file_reservations)\n- Task execution via opencode (opencode-task \u003ctask-id\u003e)\n- Exit on completion (PM2 auto-restarts)\n- Error handling -\u003e dependent task creation\n\n### Testing Locally\n```bash\n# Create a test task\nbd create --title=\"Test task for headless worker\" --type=task --priority=1 --description=\"Test the headless worker execution\"\n\n# Start PM2 with 1 worker instance\npm2 start ecosystem.config.js\n\n# Monitor execution\npm2 logs\n\n# Check if task completed\nbd ready\n\n# Stop PM2\npm2 stop all\n```\n\n### Success Criteria\n- Worker script created\n- Script is executable\n- Worker can poll Beads for tasks\n- Worker can reserve files via MCP\n- Worker can execute opencode tasks\n- Worker completes and exits (PM2 restarts)\n- File reservations prevent git conflicts\n- Failed tasks create dependent tasks automatically","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:48:11.38652+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.567941+05:30"}
{"id":"opencode-wns","title":"Design opencode hook architecture (session-start.sh, check-cass-memory, check-mcp-agent-mail, check-beads, check-bv)","description":"Create ~/.config/opencode/hooks/ directory and implement session-start.sh as main entry point. Implement 5 check hooks: check-cass-memory.sh (verifies cm installation and config), check-mcp-agent-mail.sh (checks tool-agnostic MCP Agent Mail in ~/.mcp-agent-mail or ~/.factory/mcp_agent_mail), check-beads.sh (verifies bd CLI), check-bv.sh (verifies Beads Viewer). All hooks check-only (no installation), report status with clear messages.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T11:56:51.409679+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Completed by opencode-o0b - hook directory and all 5 hooks implemented","dependencies":[{"issue_id":"opencode-wns","depends_on_id":"opencode-o0b","type":"blocks","created_at":"2026-01-06T11:56:51.410836+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-wva","title":"Convert research droids - remove Factory dependencies","description":"Remove MCP Agent Mail registration code from 9 research droids: codebase-researcher, context-researcher, git-history-analyzer, library-source-reader, domain-specialist, best-practices-researcher, file-picker-agent, semantic-search, figma-design-extractor. Keep core research capabilities and methodology.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T18:43:19.727768+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Removed MCP Agent Mail registration code from all 8 research droids. Each file cleaned of Session Initialization sections and MCP Agent Mail Integration blocks. Kept core research capabilities, methodology, and Senior Engineer Framework intelligence gathering.","dependencies":[{"issue_id":"opencode-wva","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:19.728719+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-yl1","title":"Remove Factory-specific agent files","description":"Delete 12 Factory-specific files from agent/ folder: orchestrator.md, task-coordinator.md, orchestrator.py, enhanced_orchestrator.py, specialized_agents.py, handoff_protocol.py, AGENT_ROLES.yaml, mcp_agent_mail_client.py, MESSAGE_FORMATS.md, README-ai-dev-tasks.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T18:43:01.00827+05:30","created_by":"buddhi","updated_at":"2026-01-08T17:38:38.227769+05:30","close_reason":"Removed all 12 Factory-specific files: orchestrator.md, task-coordinator.md, orchestrator.py, enhanced_orchestrator.py, specialized_agents.py, handoff_protocol.py, AGENT_ROLES.yaml, mcp_agent_mail_client.py, MESSAGE_FORMATS.md, README-ai-dev-tasks.md","dependencies":[{"issue_id":"opencode-yl1","depends_on_id":"opencode-pqy","type":"discovered-from","created_at":"2026-01-06T18:43:01.011125+05:30","created_by":"buddhi"}],"deleted_at":"2026-01-08T17:38:38.227769+05:30","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"opencode-z2f","title":"Create PM2 ecosystem configuration","description":"Create ecosystem.config.js for PM2 process management with headless worker configuration","design":"## PM2 Ecosystem Configuration\n\n### File Location\n~/.config/opencode/ecosystem.config.js\n\n### Configuration\n```javascript\nmodule.exports = {\n  apps: [{\n    name: 'headless-swarm',\n    script: './bin/headless-worker.js',\n    instances: 4,  // 4 parallel workers (configurable)\n    autorestart: true,\n    max_restarts: 10,\n    max_memory_restart: '1G',\n    error_file: '~/.config/opencode/logs/err.log',\n    out_file: '~/.config/opencode/logs/out.log',\n    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    merge_logs: true,\n    kill_timeout: 5000\n  }]\n};\n```\n\n### Key Settings\n- **instances**: 4 parallel workers (scale with: pm2 scale headless-swarm 8)\n- **max_memory_restart**: Restart worker if \u003e 1GB RAM\n- **max_restarts**: Auto-restart up to 10 times\n- **merge_logs**: Combine all worker logs\n- **autorestart**: PM2 auto-restarts crashed workers\n\n### PM2 Commands (No Custom CLI Needed)\n```bash\n# Start workers\npm2 start ecosystem.config.js\n\n# Scale to different worker count\npm2 scale headless-swarm 8    # 8 workers\npm2 scale headless-swarm 2    # 2 workers\n\n# Check status\npm2 list                 # Show all workers and their status\npm2 monit                 # Real-time dashboard\n\n# View logs\npm2 logs                  # Live logs\npm2 logs --lines 100      # Last 100 lines\n\n# Control workers\npm2 stop all              # Stop all workers\npm2 restart all           # Restart all workers\npm2 delete all            # Remove all from PM2\n```\n\n### Integration Points\n- Headless worker script: ./bin/headless-worker.js\n- Beads CLI: bd ready, bd show, bd close\n- MCP Agent Mail: reserve_file_paths, release_file_reservations\n- opencode execution: opencode-task \u003ctask-id\u003e","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:18:54.583871+05:30","created_by":"buddhi","updated_at":"2026-01-08T15:05:34.460131+05:30"}
